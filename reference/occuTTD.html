<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit Single-Season and Dynamic Time-to-detection Occupancy Models — occuTTD • unmarked</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit Single-Season and Dynamic Time-to-detection Occupancy Models — occuTTD"><meta property="og:description" content="Fit time-to-detection occupancy models of Garrard et al.
  (2008, 2013), either single-season or dynamic. Time-to-detection can be
  modeled with either an exponential or Weibull distribution."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unmarked</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/unmarked.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/cap-recap.html">Modeling variation in abundance using capture-recapture data</a>
    </li>
    <li>
      <a href="../articles/colext.html">Dynamic occupancy models in unmarked</a>
    </li>
    <li>
      <a href="../articles/contributing_to_unmarked.html">Contributing to unmarked: guide to adding a new model to `unmarked`</a>
    </li>
    <li>
      <a href="../articles/distsamp.html">Distance sampling analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/occuMulti.html">Multispecies occupancy models with occuMulti</a>
    </li>
    <li>
      <a href="../articles/powerAnalysis.html">Power Analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/simulate.html">Simulating datasets</a>
    </li>
    <li>
      <a href="../articles/spp-dist.html">Modeling and mapping species distributions</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/hmecology/unmarked/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit Single-Season and Dynamic Time-to-detection Occupancy Models</h1>

    <div class="hidden name"><code>occuTTD.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit time-to-detection occupancy models of Garrard et al.
  (2008, 2013), either single-season or dynamic. Time-to-detection can be
  modeled with either an exponential or Weibull distribution.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">occuTTD</span><span class="op">(</span>psiformula<span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, gammaformula <span class="op">=</span>  <span class="op">~</span> <span class="fl">1</span>, epsilonformula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    detformula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">data</span>, ttdDist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"exp"</span>, <span class="st">"weibull"</span><span class="op">)</span>, </span>
<span>    linkPsi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logit"</span>, <span class="st">"cloglog"</span><span class="op">)</span>, <span class="va">starts</span>, method<span class="op">=</span><span class="st">"BFGS"</span>, se<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>    engine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"R"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-psiformula">psiformula<a class="anchor" aria-label="anchor" href="#arg-psiformula"></a></dt>
<dd><p>Right-hand sided formula for the initial probability of
    occupancy at each site.</p></dd>

  <dt id="arg-gammaformula">gammaformula<a class="anchor" aria-label="anchor" href="#arg-gammaformula"></a></dt>
<dd><p>Right-hand sided formula for colonization probability.</p></dd>

  <dt id="arg-epsilonformula">epsilonformula<a class="anchor" aria-label="anchor" href="#arg-epsilonformula"></a></dt>
<dd><p>Right-hand sided formula for extinction probability.</p></dd>

  <dt id="arg-detformula">detformula<a class="anchor" aria-label="anchor" href="#arg-detformula"></a></dt>
<dd><p>Right-hand sided formula for mean time-to-detection.</p></dd>

  <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p><code>unmarkedFrameOccuTTD</code> object that supplies the data
    (see <code><a href="unmarkedFrameOccuTTD.html">unmarkedFrameOccuTTD</a></code>).</p></dd>

  <dt id="arg-ttddist">ttdDist<a class="anchor" aria-label="anchor" href="#arg-ttddist"></a></dt>
<dd><p>Distribution to use for time-to-detection; either
    <code>"exp"</code> for the exponential, or <code>"weibull"</code> for the Weibull,
    which adds an additional shape parameter \(k\).</p></dd>

  <dt id="arg-linkpsi">linkPsi<a class="anchor" aria-label="anchor" href="#arg-linkpsi"></a></dt>
<dd><p>Link function for the occupancy model. Options are
    <code>"logit"</code> for the standard occupancy model or <code>"cloglog"</code>
    for the complimentary log-log link, which relates occupancy
    to site-level abundance.</p></dd>

  <dt id="arg-starts">starts<a class="anchor" aria-label="anchor" href="#arg-starts"></a></dt>
<dd><p>optionally, initial values for parameters in the optimization.</p></dd>

  <dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Optimization method used by <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>.</p></dd>

  <dt id="arg-se">se<a class="anchor" aria-label="anchor" href="#arg-se"></a></dt>
<dd><p>logical specifying whether or not to compute standard errors.</p></dd>

  <dt id="arg-engine">engine<a class="anchor" aria-label="anchor" href="#arg-engine"></a></dt>
<dd><p>Either "C" or "R" to use fast C++ code or native R
    code during the optimization.</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to optim, such as lower and upper bounds</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>unmarkedFitOccuTTD object describing model fit.</p>
    </div>
    <div id="details">
    <h2>Details</h2>


<p>Estimates site occupancy and detection probability from time-to-detection
(TTD) data, e.g. time to first detection of a particular bird species
during a point count or time-to-detection of a plant species while searching
a quadrat (Garrard et al. 2008). Time-to-detection can be modeled
as an exponential (<code>ttdDist="exp"</code>) or Weibull (<code>ttdDist="weibull"</code>)
random variable with rate parameter \(\lambda\) and, for the Weibull,
an additional shape parameter \(k\). Note that <code>occuTTD</code> puts covariates
on \(\lambda\) and not \(1/\lambda\), i.e., the expected time between events.</p>
<p>In the case where there are no detections before the maximum sample time at
a site (<code>surveyLength</code>) is reached, we are not sure if the site is
unoccupied or if we just didn't wait long enough for a detection. We therefore
must censor the exponential or Weibull distribution at the maximum survey
length, \(Tmax\). Thus, assuming true site occupancy at site \(i\) is
\(z_i\), an exponential distribution for the TTD \(y_i\), and that
\(d_i = 1\) indicates \(y_i\) is censored (Kery and Royle 2016):</p>
<p>$$d_i = z_i * I(y_i &gt; Tmax_i) + (1 - z_i)$$</p>
<p>and</p>
<p>$$y_i|z_i \sim Exponential(\lambda_i), d_i = 0$$
$$y_i|z_i = Missing, d_i = 1$$</p>
<p>Because in <code>unmarked</code> values of <code>NA</code> are typically used to indicate
missing values that were a result of the sampling structure (e.g., lost data),
we indicate a censored \(y_i\) in <code>occuTTD</code> instead by setting
\(y_i = Tmax_i\) in the <code>y</code> matrix provided to
<code><a href="unmarkedFrameOccuTTD.html">unmarkedFrameOccuTTD</a></code>. You can provide either a single value of
\(Tmax\) to the <code>surveyLength</code> argument of <code>unmarkedFrameOccuTTD</code>,
or provide a matrix, potentially with a unique value of \(Tmax\) for each
value of <code>y</code>. Note that in the latter case the value of <code>y</code> that will
be interpreted by <code>occuTTD</code> as a censored observation (i.e., \(Tmax\))
will differ between observations!</p>
<p>Occupancy and detection can be estimated with only a single survey per site,
unlike a traditional occupancy model that requires at least two replicated
surveys at at least some sites. However, <code>occuTTD</code> also supports
multiple surveys per site using the model described in Garrard et al. (2013).
Furthermore, multi-season dynamic models are supported, using the same basic
structure as for standard occupancy models (see <code><a href="colext.html">colext</a></code>).</p>
<p>When <code>linkPsi = "cloglog"</code>, the complimentary log-log link
function is used for \(psi\) instead of the logit link. The cloglog link
relates occupancy probability to the intensity parameter of an underlying
Poisson process (Kery and Royle 2016). Thus, if abundance at a site is
can be modeled as \(N_i ~ Poisson(\lambda_i)\), where
\(log(\lambda_i) = \alpha + \beta*x\), then presence/absence data at the
site can be modeled as \(Z_i ~ Binomial(\psi_i)\) where
\(cloglog(\psi_i) = \alpha + \beta*x\).</p>
    </div>
    <div id="references">
    <h2>References</h2>


<p>Garrard, G.E., Bekessy, S.A., McCarthy, M.A. and Wintle, B.A. 2008. When have
  we looked hard enough? A novel method for setting minimum survey effort
  protocols for flora surveys. Austral Ecology 33: 986-998.</p>
<p>Garrard, G.E., McCarthy, M.A., Williams, N.S., Bekessy, S.A. and Wintle,
  B.A. 2013. A general model of detectability using species traits. Methods in
  Ecology and Evolution 4: 45-52.</p>
<p>Kery, Marc, and J. Andrew Royle. 2016. <em>Applied Hierarchical Modeling in
  Ecology</em>, Volume 1. Academic Press.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Ken Kellner <a href="mailto:contact@kenkellner.com">contact@kenkellner.com</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="unmarked-package.html">unmarked</a></code>, <code><a href="unmarkedFrameOccuTTD.html">unmarkedFrameOccuTTD</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Single season model</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span>; <span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Simulate occupancy</span></span></span>
<span class="r-in"><span><span class="va">scovs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>elev<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    forest<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    wind<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">beta_psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.69</span>, <span class="fl">0.71</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">scovs</span><span class="op">$</span><span class="va">elev</span>, <span class="va">scovs</span><span class="op">$</span><span class="va">forest</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_psi</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">psi</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Simulate detection</span></span></span>
<span class="r-in"><span><span class="va">Tmax</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co">#Same survey length for all observations</span></span></span>
<span class="r-in"><span><span class="va">beta_lam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">scovs</span><span class="op">$</span><span class="va">elev</span>, <span class="va">scovs</span><span class="op">$</span><span class="va">wind</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_lam</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">rate</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ttd</span><span class="op">[</span><span class="va">z</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Tmax</span> <span class="co">#Censor at unoccupied sites</span></span></span>
<span class="r-in"><span><span class="va">ttd</span><span class="op">[</span><span class="va">ttd</span><span class="op">&gt;</span><span class="va">Tmax</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Tmax</span> <span class="co">#Censor when ttd was greater than survey length</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Build unmarkedFrame</span></span></span>
<span class="r-in"><span><span class="va">umf</span> <span class="op">&lt;-</span> <span class="fu"><a href="unmarkedFrameOccuTTD.html">unmarkedFrameOccuTTD</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">ttd</span>, surveyLength<span class="op">=</span><span class="va">Tmax</span>, siteCovs<span class="op">=</span><span class="va">scovs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Fit model</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">occuTTD</span><span class="op">(</span>psiformula<span class="op">=</span><span class="op">~</span><span class="va">elev</span><span class="op">+</span><span class="va">forest</span>, detformula<span class="op">=</span><span class="op">~</span><span class="va">elev</span><span class="op">+</span><span class="va">wind</span>, data<span class="op">=</span><span class="va">umf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Predict psi values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, type<span class="op">=</span><span class="st">'psi'</span>, newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>elev<span class="op">=</span><span class="fl">0.5</span>, forest<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Predict lambda values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, type<span class="op">=</span><span class="st">'det'</span>, newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>elev<span class="op">=</span><span class="fl">0.5</span>, wind<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Calculate p, probability species is detected at a site given it is present</span></span></span>
<span class="r-in"><span><span class="co">#for a value of lambda. This is equivalent to eq 4 of Garrard et al. 2008</span></span></span>
<span class="r-in"><span><span class="va">lam</span> <span class="op">&lt;-</span> <span class="fu"><a href="predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, type<span class="op">=</span><span class="st">'det'</span>, newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>elev<span class="op">=</span><span class="fl">0.5</span>, wind<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">Predicted</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">pexp</a></span><span class="op">(</span><span class="va">Tmax</span>, <span class="va">lam</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Estimated p for all observations</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="getP-methods.html">getP</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Dynamic model</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">1000</span>; <span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="cn">T</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">scovs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>elev<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    forest<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    wind<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">beta_psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.69</span>, <span class="fl">0.71</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">scovs</span><span class="op">$</span><span class="va">elev</span>, <span class="va">scovs</span><span class="op">$</span><span class="va">forest</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_psi</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">N</span>, <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">psi</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Col/ext process</span></span></span>
<span class="r-in"><span><span class="va">ysc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>forest<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">scovs</span><span class="op">$</span><span class="va">forest</span>, each<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                  elev<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">scovs</span><span class="op">$</span><span class="va">elev</span>, each<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">c_b0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.4</span>; <span class="va">c_b1</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span></span>
<span class="r-in"><span><span class="va">gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">c_b0</span> <span class="op">+</span> <span class="va">c_b1</span> <span class="op">*</span> <span class="va">scovs</span><span class="op">$</span><span class="va">forest</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">e_b0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.7</span>; <span class="va">e_b1</span> <span class="op">&lt;-</span> <span class="fl">0.4</span></span></span>
<span class="r-in"><span><span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">e_b0</span> <span class="op">+</span> <span class="va">e_b1</span> <span class="op">*</span> <span class="va">scovs</span><span class="op">$</span><span class="va">elev</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="cn">T</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="co">#ext</span></span></span>
<span class="r-in"><span>      <span class="va">z</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ext</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="co">#col</span></span></span>
<span class="r-in"><span>      <span class="va">z</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>, <span class="va">gam</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Simulate detection</span></span></span>
<span class="r-in"><span><span class="va">ocovs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>obs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span>,<span class="va">N</span><span class="op">*</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Tmax</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">beta_lam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">scovs</span><span class="op">$</span><span class="va">elev</span>, <span class="va">scovs</span><span class="op">$</span><span class="va">wind</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_lam</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#Add second observer at each site</span></span></span>
<span class="r-in"><span><span class="va">rateB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">scovs</span><span class="op">$</span><span class="va">elev</span>, <span class="va">scovs</span><span class="op">$</span><span class="va">wind</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta_lam</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#Across seasons</span></span></span>
<span class="r-in"><span><span class="va">rate2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">rate</span>, <span class="va">rateB</span>, <span class="va">rate</span>, <span class="va">rateB</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="cn">T</span><span class="op">*</span><span class="fl">2</span>, <span class="va">rate2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">ttd</span>, nrow<span class="op">=</span><span class="va">N</span>, byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ttd</span><span class="op">[</span><span class="va">ttd</span><span class="op">&gt;</span><span class="va">Tmax</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Tmax</span></span></span>
<span class="r-in"><span><span class="va">ttd</span><span class="op">[</span><span class="va">z</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Tmax</span></span></span>
<span class="r-in"><span><span class="va">ttd</span><span class="op">[</span><span class="va">z</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Tmax</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="va">umf</span> <span class="op">&lt;-</span> <span class="fu"><a href="unmarkedFrameOccuTTD.html">unmarkedFrameOccuTTD</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ttd</span>, surveyLength <span class="op">=</span> <span class="va">Tmax</span>, </span></span>
<span class="r-in"><span>                            siteCovs <span class="op">=</span> <span class="va">scovs</span>, obsCovs<span class="op">=</span><span class="va">ocovs</span>,</span></span>
<span class="r-in"><span>                            yearlySiteCovs<span class="op">=</span><span class="va">ysc</span>, numPrimary<span class="op">=</span><span class="fl">2</span><span class="op">)</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">umf</span><span class="op">@</span><span class="va">y</span><span class="op">)</span> <span class="co">#num sites, (num surveys x num primary periods)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">occuTTD</span><span class="op">(</span>psiformula<span class="op">=</span><span class="op">~</span><span class="va">elev</span><span class="op">+</span><span class="va">forest</span>,detformula<span class="op">=</span><span class="op">~</span><span class="va">elev</span><span class="op">+</span><span class="va">wind</span><span class="op">+</span><span class="va">obs</span>,</span></span>
<span class="r-in"><span>               gammaformula<span class="op">=</span><span class="op">~</span><span class="va">forest</span>, epsilonformula<span class="op">=</span><span class="op">~</span><span class="va">elev</span>, </span></span>
<span class="r-in"><span>               data<span class="op">=</span><span class="va">umf</span>,se<span class="op">=</span><span class="cn">T</span>,engine<span class="op">=</span><span class="st">"C"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">beta_psi</span>, <span class="va">c_b0</span>, <span class="va">c_b1</span>, <span class="va">e_b0</span>, <span class="va">e_b1</span>, <span class="va">beta_lam</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Compare to truth</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>, <span class="va">truth</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://chandlerlab.uga.edu/richard-chandler-phd/" class="external-link">Richard Chandler</a>, <a href="https://kenkellner.com" class="external-link">Ken Kellner</a>, Ian Fiske, David Miller, Andy Royle, Jeff Hostetler, Rebecca Hutchinson, Adam Smith, Lea Pautrel.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

