<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit Single-Season and Dynamic Multi-State Occupancy Models — occuMS • unmarked</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit Single-Season and Dynamic Multi-State Occupancy Models — occuMS"><meta property="og:description" content="This function fits single-season and dynamic multi-state occupancy models with both the multinomial and conditional binomial parameterizations."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unmarked</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/unmarked.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/cap-recap.html">Modeling variation in abundance using capture-recapture data</a>
    </li>
    <li>
      <a href="../articles/colext.html">Dynamic occupancy models in unmarked</a>
    </li>
    <li>
      <a href="../articles/contributing_to_unmarked.html">Contributing to unmarked: guide to adding a new model to `unmarked`</a>
    </li>
    <li>
      <a href="../articles/distsamp.html">Distance sampling analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/occuMulti.html">Multispecies occupancy models with occuMulti</a>
    </li>
    <li>
      <a href="../articles/powerAnalysis.html">Power Analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/simulate.html">Simulating datasets</a>
    </li>
    <li>
      <a href="../articles/spp-dist.html">Modeling and mapping species distributions</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/hmecology/unmarked/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit Single-Season and Dynamic Multi-State Occupancy Models</h1>

    <div class="hidden name"><code>occuMS.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function fits single-season and dynamic multi-state occupancy models with both the multinomial and conditional binomial parameterizations.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">occuMS</span><span class="op">(</span><span class="va">detformulas</span>, <span class="va">psiformulas</span>, phiformulas<span class="op">=</span><span class="cn">NULL</span>, <span class="va">data</span>, </span>
<span>    parameterization<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"multinomial"</span>,<span class="st">"condbinom"</span><span class="op">)</span>,</span>
<span>    <span class="va">starts</span>, method<span class="op">=</span><span class="st">"BFGS"</span>, se<span class="op">=</span><span class="cn">TRUE</span>, engine<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="st">"R"</span><span class="op">)</span>, silent<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-detformulas">detformulas<a class="anchor" aria-label="anchor" href="#arg-detformulas"></a></dt>
<dd><p>Character vector of formulas for detection probabilities.
      See details for a description of how to order these formulas.</p></dd>

    <dt id="arg-psiformulas">psiformulas<a class="anchor" aria-label="anchor" href="#arg-psiformulas"></a></dt>
<dd><p>Character vector of formulas for occupancy probabilities.
      See details for a description of how to order these formulas.</p></dd>

    <dt id="arg-phiformulas">phiformulas<a class="anchor" aria-label="anchor" href="#arg-phiformulas"></a></dt>
<dd><p>Character vector of formulas for state transition probabilities.
      Only used if you are fitting a dynamic model. See details for a
      description of how to order these formulas.</p></dd>

    <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>An <code><a href="unmarkedFrameOccuMS.html">unmarkedFrameOccuMS</a></code> object</p></dd>

    <dt id="arg-parameterization">parameterization<a class="anchor" aria-label="anchor" href="#arg-parameterization"></a></dt>
<dd><p>Either <code>"multinomial"</code> for the multinomial
      parameterization (MacKenzie et al. 2009) which allows an arbitrary
      number of occupancy states, or <code>"condbinom"</code> for the conditional
      binomial parameterization (Nichols et al. 2007) which requires exactly
      3 occupancy states. See details.</p></dd>

    <dt id="arg-starts">starts<a class="anchor" aria-label="anchor" href="#arg-starts"></a></dt>
<dd><p>Vector of parameter starting values.</p></dd>

    <dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Optimization method used by <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>.</p></dd>

    <dt id="arg-se">se<a class="anchor" aria-label="anchor" href="#arg-se"></a></dt>
<dd><p>Logical specifying whether or not to compute standard
      errors.</p></dd>

    <dt id="arg-engine">engine<a class="anchor" aria-label="anchor" href="#arg-engine"></a></dt>
<dd><p>Either "C" to use fast C++ code or "R" to use native R
      code during the optimization.</p></dd>

    <dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>Boolean; if <code>TRUE</code>, suppress warnings.</p></dd>

    <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to optim, such as lower and upper
      bounds</p></dd>

  </dl></div>
    <div id="details">
    <h2>Details</h2>


<p>Traditional occupancy models fit data with exactly two states: detection and
non-detection (MacKenzie et al. 2002).
The <code>occuMS</code> function fits models to occupancy data for which there are
greater than 2 states (Nichols et al 2007, MacKenzie et al. 2009). For example,
detections may be further divided into multiple biologically relevant categories,
e.g. breeding vs. non-breeding, or some/many individuals present. As with
detection status, classification of these additional occupancy states is likely
to be imperfect.</p>
<p>Multiple parameterizations for multi-state occupancy models have been proposed.
The <code>occuMS</code> function fits two at present: the "conditional binomial"
parameterization of Nichols et al. (2007), and the more general "multinomial"
parameterization of MacKenzie et al. (2009). Both single-season
and dynamic models are possible with <code>occuMS</code> (MacKenzie et al. 2009).</p>
<p>The conditional binomial parameterization
(<code>parameterization = 'condbinom'</code>) models occupancy and the presence or
absence of an additional biological state of interest given the species
is present (typically breeding status). Thus, there should be exactly 3 occupancy
states in the data: 0 (non-detection); 1 (detection, no evidence of breeding);
or 2 (detection, evidence of breeding).</p>
<p>Two state parameters are estimated:
\(\psi\), the probability of occupancy, and \(R\), the probability of
successful reproduction given an occupied state (although this could be some
other binary biological condition). Covariates (in <code>siteCovs</code>) can be
supplied for either or both of these parameters with the <code>stateformulas</code>
argument, which takes a character vector of R-style formulas with length = 2,
with formulas in the order (\(\psi\), \(R\)). For example, to fit a model
where \(\psi\) varies with a landcover covariate and \(R\) is constant,
<code>stateformulas = c('~landcover','~1')</code>.</p>
<p>There are three detection parameters associated with the
conditional binomial parameterization: \(p_1\), the probability of
detecting the species given true state 1; \(p_2\), the probability of detecting
the species given true state 2; and \(\delta\), the probability of detecting
state 2 (i.e., breeding), given that the species has been detected.
See MacKenzie et al. (2009), pages 825-826 for more details.
As with occupancy, covariates (in <code>obsCovs</code>) can be supplied for these
detection probabilities with the <code>detformulas</code> argument, which takes a
character vector of formulas with length = 3 in the order
(\(p_1\), \(p_2\), \(\delta\)). So, to fit a model where \(p_1\) varies
with temperature and the other two parameters are constant,
<code>detformulas = c('~temp','~1','~1')</code>.</p>
<p>The multinomial parameterization (<code>parameterization = "multinomial"</code>) is
more general, allowing an arbitrary number of occupancy states \(S\).
\(S\) - 1 occupancy probabilities \(\psi\) are estimated. Thus, if there
are \(S\) = 4 occupancy states (0, 1, 2, 3), <code>occuMS</code> estimates \(\psi_1\),
\(\psi_2\), and \(\psi_3\) (the probability of state 0 can be obtained by
subtracting the others from 1). Covariates can be supplied for each occupancy
probability with a character vector with length \(S-1\), e.g.
<code>stateformulas =</code> <code>c('~landcover','~1','~1')</code> where \(\psi_1\) varies with
landcover and \(\psi_2\) and \(\psi_3\) are constant.</p>
<p>The number of detection probabilities estimated quickly expands as \(S\)
increases, equal to \(S \times (S-1) / 2\). In the simplest case
(when \(S\) = 3), there are 3 detection probabilities: \(p_{11}\),
the probability of detecting state 1 given true state 1; \(p_{12}\),
the probability of detecting state 1 given true state 2; and \(p_{22}\),
the probability of detecting state 2 given true state 2.
Covariates can be supplied for any or all of these detection probabilities with
the <code>detformulas</code> argument, which takes a character vector of formulas
with length = 3 in the order (\(p_{11}\), \(p_{12}\), \(p_{22}\)). So,
to fit a model where \(p_{11}\) varies with temperature and the other two detection
probabilities are constant, <code>detformulas = c('~temp','~1','~1')</code>.
If there were \(S\) = 4 occupancy states, there are 6 estimated detection
probabilities and the order is (\(p_{11}\), \(p_{12}\), \(p_{13}\),
\(p_{22}\), \(p_{23}\), \(p_{33}\)), and so on. See MacKenzie et al. (2009)
for a more detailed explanation.</p>
<p>Dynamic (multi-season) models can be fit as well for both parameterizations
(MacKenzie et al. 2009). In a standard dynamic occupancy model, additional
parameters for probabilities of colonization (i.e., state 0 -&gt; 1) and
extinction (1 -&gt; 0) are estimated. In a multi-state context, we must estimate a
transition probability matrix (\(\phi\)) between all possible states. You can
provide formulas for some of the probabilities in this matrix using the
<code>phiformulas</code> argument. The approach differs depending on parameterization.</p>
<p>For the conditional binomial parameterization, <code>phiformulas</code> is a
character vector of length 6. The first three elements are formulas for the
probability a site is occupied at time \(t\) given that it was previously
in states 0, 1, or 2 at time \(t-1\) (<code>phi0, phi1, phi2</code>). Elements 4-6
are formulas for the probability of reproduction (or other biological state)
given state 0, 1, or 2 at time \(t-1\) (<code>R0, R1, R2</code>). See
<code>umf@phiOrder$cond_binom</code> for a reminder of the correct order, where
<code>umf</code> is your <code>unmarkedFrameOccuMS</code>.</p>
<p>For the multinomial parameterization, <code>phiformulas</code> can be used to provide
formulas for some transitions between different occupancy states. You can't
give formulas for the probabilities of remaining in the same state between
seasons to keep the model identifiable. Thus, if there are 3 possible states
(0, 1, 2), <code>phiformulas</code> should contain 6 formulas for the following
transitions: <code>p(0-&gt;1), p(0-&gt;2), p(1-&gt;0), p(1-&gt;2), p(2-&gt;0), p(2-&gt;1)</code>,
in that order (and similar for more than 3 states). The remaining probabilities
of staying in the same state between seasons can be obtained via subtraction.
See <code>umf@phiOrder$multinomial</code> for the correct order matching the number
of states in your dataset.</p>
<p>See <code><a href="unmarkedFrame.html">unmarkedFrame</a></code> and <code><a href="unmarkedFrameOccuMS.html">unmarkedFrameOccuMS</a></code> for a
description of how to supply data to the <code>data</code> argument.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>unmarkedFitOccuMS object describing the model fit.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>MacKenzie, D. I., J. D. Nichols, G. B. Lachman, S. Droege,
  J. Andrew Royle, and C. A. Langtimm. 2002. Estimating Site Occupancy Rates
  When Detection Probabilities Are Less Than One. Ecology 83: 2248-2255.</p>
<p>MacKenzie, D. I., Nichols, J. D., Seamans, M. E., and R. J. Gutierrez, 2009.
  Modeling species occurrence dynamics with multiple states and imperfect
  detection. Ecology 90: 823-835.</p>
<p>Nichols, J. D., Hines, J. E., Mackenzie, D. I., Seamans, M. E., and
  R. J. Gutierrez. 2007. Occupancy estimation and modeling with multiple states
  and state uncertainty. Ecology 88: 1395-1400.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Ken Kellner <a href="mailto:contact@kenkellner.com">contact@kenkellner.com</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="unmarked-package.html">unmarked</a></code>, <code><a href="unmarkedFrameOccuMS.html">unmarkedFrameOccuMS</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Simulate data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Parameters</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span>; <span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">5</span>; <span class="va">S</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="va">site_covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obs_covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="va">J</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">a1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.5</span>; <span class="va">b1</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">a2</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.6</span>; <span class="va">b2</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.7</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##################################</span></span></span>
<span class="r-in"><span><span class="co">## Multinomial parameterization ##</span></span></span>
<span class="r-in"><span><span class="co">##################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">p11</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.4</span>; <span class="va">p12</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1.09</span>; <span class="va">p22</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">0.84</span></span></span>
<span class="r-in"><span><span class="va">truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a1</span>,<span class="va">b1</span>,<span class="va">a2</span>,<span class="va">b2</span>,<span class="va">p11</span>,<span class="fl">0</span>,<span class="va">p12</span>,<span class="va">p22</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#State process</span></span></span>
<span class="r-in"><span><span class="va">lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,ncol<span class="op">=</span><span class="va">S</span>,nrow<span class="op">=</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">lp</span><span class="op">[</span><span class="va">n</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">a1</span><span class="op">+</span><span class="va">b1</span><span class="op">*</span><span class="va">site_covs</span><span class="op">[</span><span class="va">n</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">lp</span><span class="op">[</span><span class="va">n</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">a2</span><span class="op">+</span><span class="va">b2</span><span class="op">*</span><span class="va">site_covs</span><span class="op">[</span><span class="va">n</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">lp</span><span class="op">[</span><span class="va">n</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>  </span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">psi_mat</span> <span class="op">&lt;-</span> <span class="va">lp</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">z</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span>, replace<span class="op">=</span><span class="cn">T</span>, prob<span class="op">=</span><span class="va">psi_mat</span><span class="op">[</span><span class="va">n</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">probs_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">p11</span><span class="op">)</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">p12</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">p22</span><span class="op">)</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">3</span>,byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">probs_raw</span> <span class="op">&lt;-</span> <span class="va">probs_raw</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">probs_raw</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,nrow<span class="op">=</span><span class="va">N</span>,ncol<span class="op">=</span><span class="va">J</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">n</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                  <span class="va">probs_raw</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>,</span></span>
<span class="r-in"><span>                  <span class="va">probs_raw</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>,</span></span>
<span class="r-in"><span>                  <span class="va">probs_raw</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">n</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">y</span><span class="op">[</span><span class="va">n</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="va">J</span>, replace<span class="op">=</span><span class="cn">T</span>, <span class="va">probs</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Construct unmarkedFrame</span></span></span>
<span class="r-in"><span><span class="va">umf</span> <span class="op">&lt;-</span> <span class="fu"><a href="unmarkedFrameOccuMS.html">unmarkedFrameOccuMS</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>,siteCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">site_covs</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           obsCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">obs_covs</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Formulas</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#3 states, so detformulas is a character vector of formulas of </span></span></span>
<span class="r-in"><span><span class="co">#length 3 in following order:</span></span></span>
<span class="r-in"><span><span class="co">#1) p[11]: prob of detecting state 1 given true state 1</span></span></span>
<span class="r-in"><span><span class="co">#2) p[12]: prob of detecting state 1 given true state 2</span></span></span>
<span class="r-in"><span><span class="co">#3) p[22]: prob of detecting state 2 given true state 2</span></span></span>
<span class="r-in"><span><span class="va">detformulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'~V1'</span>,<span class="st">'~1'</span>,<span class="st">'~1'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#If you had 4 states, it would be p[11],p[12],p[13],p[22],p[23],p[33] and so on</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#3 states, so stateformulas is a character vector of length 2 in following order:</span></span></span>
<span class="r-in"><span><span class="co">#1) psi[1]: probability of state 1</span></span></span>
<span class="r-in"><span><span class="co">#2) psi[2]: probability of state 2</span></span></span>
<span class="r-in"><span><span class="co">#You can get probability of state 0 (unoccupied) as 1 - psi[1] - psi[2]</span></span></span>
<span class="r-in"><span><span class="va">stateformulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'~V1'</span>,<span class="st">'~V2'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Fit model</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">occuMS</span><span class="op">(</span><span class="va">detformulas</span>, <span class="va">stateformulas</span>, data<span class="op">=</span><span class="va">umf</span>,</span></span>
<span class="r-in"><span>              parameterization<span class="op">=</span><span class="st">"multinomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Look at results</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-in"><span><span class="co">#Compare with truth</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>truth<span class="op">=</span><span class="va">truth</span>,estimate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Generate predicted values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fit</span>,type<span class="op">=</span><span class="st">'psi'</span><span class="op">)</span>,<span class="va">head</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fit</span>,type<span class="op">=</span><span class="st">'det'</span><span class="op">)</span>,<span class="va">head</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Fit a null model</span></span></span>
<span class="r-in"><span><span class="va">detformulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'~1'</span>,<span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">stateformulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'~1'</span>,<span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit_null</span> <span class="op">&lt;-</span> <span class="fu">occuMS</span><span class="op">(</span><span class="va">detformulas</span>, <span class="va">stateformulas</span>, data<span class="op">=</span><span class="va">umf</span>,</span></span>
<span class="r-in"><span>                   parameterization<span class="op">=</span><span class="st">"multinomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Compare fits</span></span></span>
<span class="r-in"><span><span class="fu"><a href="modSel.html">modSel</a></span><span class="op">(</span><span class="fu"><a href="fitList.html">fitList</a></span><span class="op">(</span><span class="va">fit</span>,<span class="va">fit_null</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########################################</span></span></span>
<span class="r-in"><span><span class="co">## Conditional binomial parameterization ##</span></span></span>
<span class="r-in"><span><span class="co">###########################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">p11</span> <span class="op">&lt;-</span> <span class="fl">0.4</span>; <span class="va">p12</span> <span class="op">&lt;-</span> <span class="fl">0.6</span>; <span class="va">p22</span> <span class="op">&lt;-</span> <span class="fl">0.8</span></span></span>
<span class="r-in"><span><span class="va">truth_cb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">a1</span>,<span class="va">b1</span>,<span class="va">a2</span>,<span class="va">b2</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="va">p11</span><span class="op">)</span>,<span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p12</span>,<span class="va">p22</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Simulate data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#State process</span></span></span>
<span class="r-in"><span><span class="va">psi_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,ncol<span class="op">=</span><span class="va">S</span>,nrow<span class="op">=</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">psi_mat</span><span class="op">[</span><span class="va">n</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">a1</span><span class="op">+</span><span class="va">b1</span><span class="op">*</span><span class="va">site_covs</span><span class="op">[</span><span class="va">n</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">psi_mat</span><span class="op">[</span><span class="va">n</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">a2</span><span class="op">+</span><span class="va">b2</span><span class="op">*</span><span class="va">site_covs</span><span class="op">[</span><span class="va">n</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">psi_bin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">psi_mat</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">psi_mat</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">psi_bin</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">psi_mat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">psi_bin</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">psi_mat</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="va">psi_mat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">psi_bin</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">psi_mat</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">psi_mat</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">z</span><span class="op">[</span><span class="va">n</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span>, replace<span class="op">=</span><span class="cn">T</span>, prob<span class="op">=</span><span class="va">psi_bin</span><span class="op">[</span><span class="va">n</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Detection process</span></span></span>
<span class="r-in"><span><span class="va">y_cb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>,nrow<span class="op">=</span><span class="va">N</span>,ncol<span class="op">=</span><span class="va">J</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co">#p11 = p1; p12 = p2; p22 = delta</span></span></span>
<span class="r-in"><span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">n</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p11</span>,<span class="va">p11</span>,<span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p12</span>,<span class="va">p12</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p22</span><span class="op">)</span>,<span class="va">p12</span><span class="op">*</span><span class="va">p22</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span>  <span class="kw">if</span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">n</span><span class="op">]</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">y_cb</span><span class="op">[</span><span class="va">n</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, <span class="va">J</span>, replace<span class="op">=</span><span class="cn">T</span>, <span class="va">probs</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Build unmarked frame</span></span></span>
<span class="r-in"><span><span class="va">umf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="unmarkedFrameOccuMS.html">unmarkedFrameOccuMS</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y_cb</span>,siteCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">site_covs</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           obsCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">obs_covs</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Formulas</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#detformulas is a character vector of formulas of length 3 in following order:</span></span></span>
<span class="r-in"><span><span class="co">#1) p[1]: prob of detecting species given true state 1</span></span></span>
<span class="r-in"><span><span class="co">#2) p[2]: prob of detecting species given true state 2</span></span></span>
<span class="r-in"><span><span class="co">#3) delta: prob of detecting state 2 (eg breeding) given species was detected</span></span></span>
<span class="r-in"><span><span class="va">detformulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'~V1'</span>,<span class="st">'~1'</span>,<span class="st">'~1'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#stateformulas is a character vector of length 2 in following order:</span></span></span>
<span class="r-in"><span><span class="co">#1) psi: probability of occupancy</span></span></span>
<span class="r-in"><span><span class="co">#2) R: probability state 2 (eg breeding) given occupancyc</span></span></span>
<span class="r-in"><span><span class="va">stateformulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'~V1'</span>,<span class="st">'~V2'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Fit model</span></span></span>
<span class="r-in"><span><span class="va">fit_cb</span> <span class="op">&lt;-</span> <span class="fu">occuMS</span><span class="op">(</span><span class="va">detformulas</span>, <span class="va">stateformulas</span>, data<span class="op">=</span><span class="va">umf2</span>,</span></span>
<span class="r-in"><span>                 parameterization<span class="op">=</span><span class="st">'condbinom'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Look at results</span></span></span>
<span class="r-in"><span><span class="va">fit_cb</span></span></span>
<span class="r-in"><span><span class="co">#Compare with truth</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>truth<span class="op">=</span><span class="va">truth_cb</span>,estimate<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_cb</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Generate predicted values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fit_cb</span>,type<span class="op">=</span><span class="st">'psi'</span><span class="op">)</span>,<span class="va">head</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fit_cb</span>,type<span class="op">=</span><span class="st">'det'</span><span class="op">)</span>,<span class="va">head</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##################################</span></span></span>
<span class="r-in"><span><span class="co">## Dynamic (multi-season) model ##</span></span></span>
<span class="r-in"><span><span class="co">##################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Simulate data-----------------------------------------------</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">500</span> <span class="co">#Number of sites</span></span></span>
<span class="r-in"><span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co">#Number of primary periods</span></span></span>
<span class="r-in"><span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co">#Number of secondary periods</span></span></span>
<span class="r-in"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co">#Number of occupancy states (0,1,2)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Generate covariates</span></span></span>
<span class="r-in"><span><span class="va">site_covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">yearly_site_covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="cn">T</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obs_covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="va">J</span><span class="op">*</span><span class="cn">T</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#True parameter values</span></span></span>
<span class="r-in"><span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="co">#Occupancy parameters</span></span></span>
<span class="r-in"><span>  a1<span class="op">=</span><span class="op">-</span><span class="fl">0.5</span>, b1<span class="op">=</span><span class="fl">1</span>, a2<span class="op">=</span><span class="op">-</span><span class="fl">0.6</span>, b2<span class="op">=</span><span class="op">-</span><span class="fl">0.7</span>,</span></span>
<span class="r-in"><span>  <span class="co">#Transition prob (phi) parameters</span></span></span>
<span class="r-in"><span>  phi01<span class="op">=</span><span class="fl">0.7</span>, phi01_cov<span class="op">=</span><span class="op">-</span><span class="fl">0.5</span>, phi02<span class="op">=</span><span class="op">-</span><span class="fl">0.5</span>, phi10<span class="op">=</span><span class="fl">1.2</span>, </span></span>
<span class="r-in"><span>  phi12<span class="op">=</span><span class="fl">0.3</span>, phi12_cov<span class="op">=</span><span class="fl">1.1</span>, phi20<span class="op">=</span><span class="op">-</span><span class="fl">0.3</span>, phi21<span class="op">=</span><span class="fl">1.4</span>, phi21_cov<span class="op">=</span><span class="fl">0</span>,</span></span>
<span class="r-in"><span>  <span class="co">#Detection prob parameters</span></span></span>
<span class="r-in"><span>  p11<span class="op">=</span><span class="op">-</span><span class="fl">0.4</span>, p11_cov<span class="op">=</span><span class="fl">0</span>, p12<span class="op">=</span><span class="op">-</span><span class="fl">1.09</span>, p22<span class="op">=</span><span class="op">-</span><span class="fl">0.84</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Generate occupancy probs (multinomial parameterization)</span></span></span>
<span class="r-in"><span><span class="va">lp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, ncol<span class="op">=</span><span class="va">S</span>, nrow<span class="op">=</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lp</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">site_covs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lp</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="va">b</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">*</span><span class="va">site_covs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="va">lp</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#True occupancy state matrix</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">N</span>, ncol<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Initial occupancy</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">z</span><span class="op">[</span><span class="va">n</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">S</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, prob<span class="op">=</span><span class="va">psi</span><span class="op">[</span><span class="va">n</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Raw phi probs</span></span></span>
<span class="r-in"><span><span class="va">phi_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">N</span><span class="op">*</span><span class="cn">T</span>, ncol<span class="op">=</span><span class="va">S</span><span class="op">^</span><span class="fl">2</span><span class="op">-</span><span class="va">S</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phi_raw</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">+</span><span class="va">b</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">*</span><span class="va">yearly_site_covs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co">#p[0-&gt;1]</span></span></span>
<span class="r-in"><span><span class="va">phi_raw</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span> <span class="co">#p[0-&gt;2]</span></span></span>
<span class="r-in"><span><span class="va">phi_raw</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span> <span class="co">#p[1-&gt;0]</span></span></span>
<span class="r-in"><span><span class="va">phi_raw</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">9</span><span class="op">]</span><span class="op">+</span><span class="va">b</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">*</span><span class="va">yearly_site_covs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co">#p[1-&gt;2]</span></span></span>
<span class="r-in"><span><span class="va">phi_raw</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span><span class="op">)</span> <span class="co">#p[2-&gt;0]</span></span></span>
<span class="r-in"><span><span class="va">phi_raw</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span><span class="op">+</span><span class="va">b</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span><span class="op">*</span><span class="va">yearly_site_covs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Generate states in times 2..T</span></span></span>
<span class="r-in"><span><span class="va">px</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="cn">T</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">phi_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">phi_raw</span><span class="op">[</span><span class="va">px</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">phi_raw</span><span class="op">[</span><span class="va">px</span>,<span class="fl">2</span><span class="op">]</span>,  <span class="co"># phi|z=0</span></span></span>
<span class="r-in"><span>                        <span class="va">phi_raw</span><span class="op">[</span><span class="va">px</span>,<span class="fl">3</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">phi_raw</span><span class="op">[</span><span class="va">px</span>,<span class="fl">4</span><span class="op">]</span>,  <span class="co"># phi|z=1</span></span></span>
<span class="r-in"><span>                        <span class="va">phi_raw</span><span class="op">[</span><span class="va">px</span>,<span class="fl">5</span><span class="op">]</span>, <span class="va">phi_raw</span><span class="op">[</span><span class="va">px</span>,<span class="fl">6</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>, <span class="co"># phi|z=2</span></span></span>
<span class="r-in"><span>                      nrow<span class="op">=</span><span class="va">S</span>, byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">phi_mat</span> <span class="op">&lt;-</span> <span class="va">phi_mat</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">phi_mat</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">z</span><span class="op">[</span><span class="va">n</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">S</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, prob<span class="op">=</span><span class="va">phi_mat</span><span class="op">[</span><span class="va">z</span><span class="op">[</span><span class="va">n</span>,<span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">px</span> <span class="op">&lt;-</span> <span class="va">px</span> <span class="op">+</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span><span class="op">(</span><span class="va">t</span><span class="op">==</span><span class="cn">T</span><span class="op">)</span> <span class="va">px</span> <span class="op">&lt;-</span> <span class="va">px</span> <span class="op">+</span> <span class="fl">1</span> <span class="co">#skip last datapoint for each site</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Raw p probs</span></span></span>
<span class="r-in"><span><span class="va">p_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="co">#p|z=0</span></span></span>
<span class="r-in"><span>                  <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span><span class="op">)</span>, <span class="fl">0</span>, <span class="co">#p|z=1</span></span></span>
<span class="r-in"><span>                  <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">16</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">17</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="co">#p|z=2 </span></span></span>
<span class="r-in"><span>                nrow<span class="op">=</span><span class="va">S</span>, byrow<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p_mat</span> <span class="op">&lt;-</span> <span class="va">p_mat</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">p_mat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Simulate observation data</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow<span class="op">=</span><span class="va">N</span>, ncol<span class="op">=</span><span class="va">J</span><span class="op">*</span><span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">yx</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="cn">T</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">n</span>,<span class="va">t</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">yx</span> <span class="op">&lt;-</span> <span class="va">yx</span> <span class="op">+</span> <span class="va">J</span></span></span>
<span class="r-in"><span>      <span class="kw">next</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">y</span><span class="op">[</span><span class="va">n</span>, <span class="va">yx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">S</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span>, prob<span class="op">=</span><span class="va">p_mat</span><span class="op">[</span><span class="va">z</span><span class="op">[</span><span class="va">n</span>,<span class="va">t</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="va">yx</span> <span class="op">&lt;-</span> <span class="va">yx</span><span class="op">+</span><span class="fl">1</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="co">#-----------------------------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Model fitting</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Build UMF</span></span></span>
<span class="r-in"><span><span class="va">umf</span> <span class="op">&lt;-</span> <span class="fu"><a href="unmarkedFrameOccuMS.html">unmarkedFrameOccuMS</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>, siteCovs<span class="op">=</span><span class="va">site_covs</span>,</span></span>
<span class="r-in"><span>                           obsCovs<span class="op">=</span><span class="va">obs_covs</span>,</span></span>
<span class="r-in"><span>                           yearlySiteCovs<span class="op">=</span><span class="va">yearly_site_covs</span>,</span></span>
<span class="r-in"><span>                           numPrimary<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">umf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Formulas</span></span></span>
<span class="r-in"><span><span class="co">#Initial occupancy</span></span></span>
<span class="r-in"><span><span class="va">psiformulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'~V1'</span>,<span class="st">'~V2'</span><span class="op">)</span> <span class="co">#on psi[1] and psi[2]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Transition probs</span></span></span>
<span class="r-in"><span><span class="co">#Guide to order:</span></span></span>
<span class="r-in"><span><span class="va">umf</span><span class="op">@</span><span class="va">phiOrder</span><span class="op">$</span><span class="va">multinomial</span></span></span>
<span class="r-in"><span><span class="va">phiformulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'~V1'</span>,<span class="st">'~1'</span>,<span class="st">'~1'</span>,<span class="st">'~V2'</span>,<span class="st">'~1'</span>,<span class="st">'~V1'</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Detection probability</span></span></span>
<span class="r-in"><span><span class="va">detformulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'~V1'</span>,<span class="st">'~1'</span>,<span class="st">'~1'</span><span class="op">)</span> <span class="co">#on p[1|1], p[1|2], p[2|2]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Fit model</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">occuMS</span><span class="op">(</span>detformulas<span class="op">=</span><span class="va">detformulas</span>, psiformulas<span class="op">=</span><span class="va">psiformulas</span>,</span></span>
<span class="r-in"><span>              phiformulas<span class="op">=</span><span class="va">phiformulas</span>, data<span class="op">=</span><span class="va">umf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Compare with truth</span></span></span>
<span class="r-in"><span><span class="va">compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">b</span>,<span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">-</span><span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="SE-methods.html">SE</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">+</span><span class="fl">1.96</span><span class="op">*</span><span class="fu"><a href="SE-methods.html">SE</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">compare</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'truth'</span>,<span class="st">'estimate'</span>,<span class="st">'lower'</span>,<span class="st">'upper'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">compare</span>,<span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Estimated phi matrix for site 1</span></span></span>
<span class="r-in"><span><span class="va">phi_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">'phi'</span>, se.fit<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phi_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">phi_est</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">Predicted</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phi_est_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">S</span>, ncol<span class="op">=</span><span class="va">S</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phi_est_mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">7</span>,<span class="fl">2</span>,<span class="fl">8</span>,<span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phi_est</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">phi_est_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">phi_est_mat</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Actual phi matrix for site 1</span></span></span>
<span class="r-in"><span><span class="va">phi_act_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phi_act_mat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">7</span>,<span class="fl">2</span>,<span class="fl">8</span>,<span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">phi_raw</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">phi_act_mat</span> <span class="op">&lt;-</span> <span class="va">phi_act_mat</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">phi_act_mat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Compare</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'Estimated phi\n'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phi_est_mat</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">'Actual phi\n'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">phi_act_mat</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Rough check of model fit</span></span></span>
<span class="r-in"><span><span class="va">fit_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">fit</span>, nsim<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">fit_sim</span>,<span class="va">mean</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'gray'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">umf</span><span class="op">@</span><span class="va">y</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'red'</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#line should fall near middle of histogram</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://chandlerlab.uga.edu/richard-chandler-phd/" class="external-link">Richard Chandler</a>, <a href="https://kenkellner.com" class="external-link">Ken Kellner</a>, Ian Fiske, David Miller, Andy Royle, Jeff Hostetler, Rebecca Hutchinson, Adam Smith, Lea Pautrel.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

