<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit the occupancy model using count data — occuCOP • unmarked</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Fit the occupancy model using count data — occuCOP"><meta property="og:description" content="This function fits a single season occupancy model using count data."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unmarked</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/unmarked.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/cap-recap.html">Modeling variation in abundance using capture-recapture data</a>
    </li>
    <li>
      <a href="../articles/colext.html">Dynamic occupancy models in unmarked</a>
    </li>
    <li>
      <a href="../articles/contributing_to_unmarked.html">Contributing to unmarked: guide to adding a new model to `unmarked`</a>
    </li>
    <li>
      <a href="../articles/distsamp.html">Distance sampling analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/occuComm.html">Community occupancy models with occuComm</a>
    </li>
    <li>
      <a href="../articles/occuMulti.html">Multispecies occupancy models with occuMulti</a>
    </li>
    <li>
      <a href="../articles/powerAnalysis.html">Power Analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/simulate.html">Simulating datasets</a>
    </li>
    <li>
      <a href="../articles/spp-dist.html">Modeling and mapping species distributions</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/biodiverse/unmarked/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit the occupancy model using count data</h1>

    <div class="hidden name"><code>occuCOP.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function fits a single season occupancy model using count data.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">occuCOP</span><span class="op">(</span><span class="va">data</span>, </span>
<span>        psiformula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, lambdaformula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, </span>
<span>        <span class="va">psistarts</span>, <span class="va">lambdastarts</span>, <span class="va">starts</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"BFGS"</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>        engine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"R"</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>        return.negloglik <span class="op">=</span> <span class="cn">NULL</span>, L1 <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<p></p>
<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>An <code><a href="unmarkedFrameOccuCOP.html">unmarkedFrameOccuCOP</a></code> object created with the <code><a href="unmarkedFrameOccuCOP.html">unmarkedFrameOccuCOP</a></code> function.</p></dd>


    <dt id="arg-psiformula">psiformula<a class="anchor" aria-label="anchor" href="#arg-psiformula"></a></dt>
<dd><p>Formula describing the occupancy covariates.</p></dd>


    <dt id="arg-lambdaformula">lambdaformula<a class="anchor" aria-label="anchor" href="#arg-lambdaformula"></a></dt>
<dd><p>Formula describing the detection covariates.</p></dd>


    <dt id="arg-psistarts">psistarts<a class="anchor" aria-label="anchor" href="#arg-psistarts"></a></dt>
<dd><p>Vector of starting values for likelihood maximisation with <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> for occupancy probability \(\psi\). These values must be logit-transformed (with <code><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></code>) (see details). By default, optimisation will start at 0, corresponding to an occupancy probability of 0.5 (<code>plogis(0)</code> is 0.5).</p></dd>


    <dt id="arg-lambdastarts">lambdastarts<a class="anchor" aria-label="anchor" href="#arg-lambdastarts"></a></dt>
<dd><p>Vector of starting values for likelihood maximisation with <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> for detection rate \(\lambda\). These values must be log-transformed (with <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></code>) (see details). By default, optimisation will start at 0, corresponding to detection rate of 1 (<code>exp(0)</code> is 1).</p></dd>


    <dt id="arg-starts">starts<a class="anchor" aria-label="anchor" href="#arg-starts"></a></dt>
<dd><p>Vector of starting values for likelihood maximisation with <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>. If <code>psistarts</code> and <code>lambdastarts</code> are provided, <code>starts = c(psistarts, lambdastarts)</code>.</p></dd>


    <dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Optimisation method used by <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>.</p></dd>


    <dt id="arg-se">se<a class="anchor" aria-label="anchor" href="#arg-se"></a></dt>
<dd><p>Logical specifying whether to compute (<code>se=TRUE</code>) standard errors or not (<code>se=FALSE</code>).</p></dd>


    <dt id="arg-engine">engine<a class="anchor" aria-label="anchor" href="#arg-engine"></a></dt>
<dd><p>Code to use for optimisation. Either <code>"C"</code> for fast C++ code, or <code>"R"</code> for native R code.</p></dd>


    <dt id="arg-na-rm">na.rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Logical specifying whether to fit the model (<code>na.rm=TRUE</code>) or not (<code>na.rm=FALSE</code>) if there are NAs in the <code><a href="unmarkedFrameOccuCOP.html">unmarkedFrameOccuCOP</a></code> object.</p></dd>


    <dt id="arg-return-negloglik">return.negloglik<a class="anchor" aria-label="anchor" href="#arg-return-negloglik"></a></dt>
<dd><p>A list of vectors of parameters (<code>c(psiparams, lambdaparams)</code>). If specified, the function will not maximise likelihood but return the negative log-likelihood for the those parameters in the <code>nll</code> column of a dataframe. See an example below.</p></dd>


    <dt id="arg-l-">L1<a class="anchor" aria-label="anchor" href="#arg-l-"></a></dt>
<dd><p>Logical specifying whether the length of observations (<code>L</code>) are purposefully set to 1 (<code>L1=TRUE</code>) or not (<code>L1=FALSE</code>).</p></dd>


    <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to pass to <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>, such as lower and upper bounds or a list of control parameters.</p></dd>

  </dl></div>
    <div id="details">
    <h2>Details</h2>


<p>See <code><a href="unmarkedFrameOccuCOP.html">unmarkedFrameOccuCOP</a></code> for a description of how to supply data to the <code>data</code> argument. See <code><a href="unmarkedFrame.html">unmarkedFrame</a></code> for a more general documentation of <code>unmarkedFrame</code> objects for the different models implemented in <span class="pkg">unmarked</span>.</p>
<p></p><div class="section">
<h3 id="the-cop-occupancy-model">The COP occupancy model<a class="anchor" aria-label="anchor" href="#the-cop-occupancy-model"></a></h3>


<p><code>occuCOP</code> fits a single season occupancy model using count data, as described in Pautrel et al. (2023).</p>
<p>The <strong>occupancy sub-model</strong> is:</p>
<p>$$z_i \sim \text{Bernoulli}(\psi_i)$$</p>
<p></p><ul><li><p>With \(z_i\) the occupany state of site \(i\). \(z_i=1\) if site \(i\) is occupied by the species, <em>i.e.</em> if the species is present in site \(i\). \(z_i=0\) if site \(i\) is not occupied.</p></li>
<li><p>With \(\psi_i\) the occupancy probability of site \(i\).</p></li>
</ul><p>The <strong>observation sub-model</strong> is:</p>
<p>$$
      N_{ij} | z_i = 1 \sim \text{Poisson}(\lambda_{ij} L_{ij}) \\
      N_{ij} | z_i = 0 \sim 0
    $$</p>
<p></p><ul><li><p>With \(N_{ij}\) the count of detection events in site \(i\) during observation \(j\).</p></li>
<li><p>With \(\lambda_{ij}\) the detection rate in site \(i\) during observation \(j\) (<em>for example, 1 detection per day.</em>).</p></li>
<li><p>With \(L_{ij}\) the length of observation \(j\) in site \(i\) (<em>for example, 7 days.</em>).</p></li>
</ul><p>What we call "observation" (\(j\)) here can be a sampling occasion, a transect, a discretised session. Consequently, the unit of \(\lambda_{ij}\) and \(L_{ij}\) can be either a time-unit (day, hour, ...) or a space-unit (kilometer, meter, ...).</p>
</div>

<p></p><div class="section">
<h3 id="the-transformation-of-parameters-psi-and-lambda-">The transformation of parameters \(\psi\) and \(\lambda\)<a class="anchor" aria-label="anchor" href="#the-transformation-of-parameters-psi-and-lambda-"></a></h3>
<p>In order to perform unconstrained optimisation, parameters are transformed.</p>
<p>The occupancy probability (\(\psi\)) is transformed with the logit function (<code>psi_transformed = qlogis(psi)</code>). It can be back-transformed with the "inverse logit" function (<code>psi = plogis(psi_transformed)</code>).</p>
<p>The detection rate (\(\lambda\)) is transformed with the log function (<code>lambda_transformed = log(lambda)</code>). It can be back-transformed with the exponential function (<code>lambda = exp(lambda_transformed)</code>).</p>
</div>


    </div>
    <div id="value">
    <h2>Value</h2>
    <p><code>unmarkedFitOccuCOP</code> object describing the model fit. See the <code><a href="unmarkedFit-class.html">unmarkedFit</a></code> classes.</p>
    </div>
    <div id="references">
    <h2>References</h2>


<p>Pautrel, L., Moulherat, S., Gimenez, O. &amp; Etienne, M.-P. Submitted. <em>Analysing biodiversity observation data collected in continuous time: Should we use discrete or continuous-time occupancy models?</em> Preprint at <a href="https://doi.org/10.1101/2023.11.17.567350" class="external-link">doi:10.1101/2023.11.17.567350</a>
.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Léa Pautrel</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="unmarked-package.html">unmarked</a></code>,
  <code><a href="unmarkedFrameOccuCOP.html">unmarkedFrameOccuCOP</a></code>,
  <code><a href="unmarkedFit-class.html">unmarkedFit-class</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>max.print <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We simulate data in 100 sites with 3 observations of 7 days per site.</span></span></span>
<span class="r-in"><span><span class="va">nSites</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">nObs</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For an occupancy covariate, we associate each site to a land-use category.</span></span></span>
<span class="r-in"><span><span class="va">landuse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Forest"</span>, <span class="st">"Grassland"</span>, <span class="st">"City"</span><span class="op">)</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                  size <span class="op">=</span> <span class="va">nSites</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">simul_psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">landuse</span> <span class="op">==</span> <span class="st">"Forest"</span>, <span class="fl">0.8</span>, </span></span>
<span class="r-in"><span>                    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">landuse</span> <span class="op">==</span> <span class="st">"Grassland"</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nSites</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">simul_psi</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For a detection covariate, we create a fake wind variable.</span></span></span>
<span class="r-in"><span><span class="va">wind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nSites</span> <span class="op">*</span> <span class="va">nObs</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">nSites</span>, ncol <span class="op">=</span> <span class="va">nObs</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">simul_lambda</span> <span class="op">&lt;-</span> <span class="va">wind</span> <span class="op">/</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="va">L</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">7</span>, nrow <span class="op">=</span> <span class="va">nSites</span>, ncol <span class="op">=</span> <span class="va">nObs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We now simulate count detection data</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">nSites</span> <span class="op">*</span> <span class="va">nObs</span>, lambda <span class="op">=</span> <span class="va">simul_lambda</span> <span class="op">*</span> <span class="va">L</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>            nrow <span class="op">=</span> <span class="va">nSites</span>, ncol <span class="op">=</span> <span class="va">nObs</span><span class="op">)</span> <span class="op">*</span> <span class="va">z</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We create our unmarkedFrameOccuCOP object</span></span></span>
<span class="r-in"><span><span class="va">umf</span> <span class="op">&lt;-</span> <span class="fu"><a href="unmarkedFrameOccuCOP.html">unmarkedFrameOccuCOP</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">y</span>,</span></span>
<span class="r-in"><span>  L <span class="op">=</span> <span class="va">L</span>,</span></span>
<span class="r-in"><span>  siteCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"landuse"</span> <span class="op">=</span> <span class="va">landuse</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  obsCovs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"wind"</span> <span class="op">=</span> <span class="va">wind</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">umf</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data frame representation of unmarkedFrame object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   y.1 y.2 y.3 L.1 L.2 L.3   landuse     wind.1    wind.2     wind.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   0   0   0   7   7   7      City 3.46359489 0.3615751 1.27416223</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   3   2   0   7   7   7      City 1.27402772 0.9609442 0.62460966</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   0   0   0   7   7   7      City 1.08148515 0.6631372 0.09404684</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   0   0   0   7   7   7 Grassland 0.29695916 1.5776374 0.38352803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   0   0   0   7   7   7      City 0.08416073 1.9224809 0.17492273</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 95 rows ]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We fit our model without covariates</span></span></span>
<span class="r-in"><span><span class="va">fitNull</span> <span class="op">&lt;-</span> <span class="fu">occuCOP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">umf</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fitNull</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> occuCOP(data = umf)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Occupancy probability (logit-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimate    SE     z P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    -0.377 0.207 -1.82  0.0683</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Detection rate (log-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimate     SE     z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -1.64 0.0805 -20.4 4.11e-92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 320.7247 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of sites: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We fit our model with covariates</span></span></span>
<span class="r-in"><span><span class="va">fitCov</span> <span class="op">&lt;-</span> <span class="fu">occuCOP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">umf</span>, psiformula <span class="op">=</span> <span class="op">~</span> <span class="va">landuse</span>, lambdaformula <span class="op">=</span> <span class="op">~</span> <span class="va">wind</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fitCov</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> occuCOP(data = umf, psiformula = ~landuse, lambdaformula = ~wind)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Occupancy probability (logit-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate    SE     z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   -0.417 0.268 -1.56 1.19e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> landuse.L      1.073 0.461  2.33 1.98e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> landuse.Q     -1.986 0.461 -4.31 1.66e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Detection rate (log-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate    SE     z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   -2.520 0.178 -14.2 1.16e-45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> wind           0.651 0.088   7.4 1.41e-13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 262.6408 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of sites: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We back-transform the parameter's estimates</span></span></span>
<span class="r-in"><span><span class="co">## Back-transformed occupancy probability with no covariates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="predict.html">predict</a></span><span class="op">(</span><span class="va">fitNull</span>, <span class="st">"psi"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Predicted         SE     lower     upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.4068805 0.04988546 0.3138839 0.5070673</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Back-transformed occupancy probability depending on habitat use</span></span></span>
<span class="r-in"><span><span class="fu"><a href="predict.html">predict</a></span><span class="op">(</span><span class="va">fitCov</span>,</span></span>
<span class="r-in"><span>        <span class="st">"psi"</span>,</span></span>
<span class="r-in"><span>        newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"landuse"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Forest"</span>, <span class="st">"Grassland"</span>, <span class="st">"City"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        appendData <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Predicted         SE      lower     upper   landuse</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.65848269 0.10390413 0.43806132 0.8266564    Forest</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.08296593 0.04043091 0.03094064 0.2040496 Grassland</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.39724666 0.06412076 0.28053391 0.5269522      City</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Back-transformed detection rate with no covariates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="predict.html">predict</a></span><span class="op">(</span><span class="va">fitNull</span>, <span class="st">"lambda"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Predicted         SE     lower     upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.1942772 0.01563752 0.1659235 0.2274761</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Back-transformed detection rate depending on wind</span></span></span>
<span class="r-in"><span><span class="fu"><a href="predict.html">predict</a></span><span class="op">(</span><span class="va">fitCov</span>,</span></span>
<span class="r-in"><span>        <span class="st">"lambda"</span>,</span></span>
<span class="r-in"><span>        appendData <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Predicted         SE      lower     upper y.1 y.2 y.3   landuse    wind.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.7660928 0.12844196 0.55153136 1.0641247   0   0   0      City 3.4635949</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.1017691 0.01527607 0.07583087 0.1365795   3   2   0      City 1.2740277</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.1842991 0.01719451 0.15350016 0.2212776   0   0   0      City 1.0814852</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.1842830 0.01719408 0.15348497 0.2212608   0   0   0 Grassland 0.2969592</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      wind.2     wind.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.3615751 1.27416223</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.9609442 0.62460966</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.6631372 0.09404684</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 1.5776374 0.38352803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 296 rows ]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This is not easily readable. We can show the results in a clearer way, by:</span></span></span>
<span class="r-in"><span><span class="co">##  - adding the site and observation</span></span></span>
<span class="r-in"><span><span class="co">##  - printing only the wind covariate used to get the predicted lambda</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"site"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nSites</span>, each <span class="op">=</span> <span class="va">nObs</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">"observation"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nObs</span>, times <span class="op">=</span> <span class="va">nSites</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">"wind"</span> <span class="op">=</span> <span class="fu"><a href="unmarkedFit-class.html">getData</a></span><span class="op">(</span><span class="va">fitCov</span><span class="op">)</span><span class="op">@</span><span class="va">obsCovs</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="predict.html">predict</a></span><span class="op">(</span><span class="va">fitCov</span>, <span class="st">"lambda"</span>, appendData <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   site observation      wind Predicted         SE      lower     upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    1           1 3.4635949 0.7660928 0.12844196 0.55153136 1.0641247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    1           2 0.3615751 0.1017691 0.01527607 0.07583087 0.1365795</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    1           3 1.2741622 0.1842991 0.01719451 0.15350016 0.2212776</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    2           1 1.2740277 0.1842830 0.01719408 0.15348497 0.2212608</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    2           2 0.9609442 0.1503157 0.01646401 0.12127535 0.1863099</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    2           3 0.6246097 0.1207681 0.01584938 0.09337750 0.1561933</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7    3           1 1.0814852 0.1625813 0.01669911 0.13293567 0.1988380</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 293 rows ]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can choose the initial parameters when fitting our model.</span></span></span>
<span class="r-in"><span><span class="co"># For psi, intituively, the initial value can be the proportion of sites </span></span></span>
<span class="r-in"><span><span class="co">#          in which we have observations.</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">psi_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">rowSums</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For lambda, the initial value can be the mean count of detection events </span></span></span>
<span class="r-in"><span><span class="co">#             in sites in which there was at least one observation.</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">lambda_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fu">rowSums</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.383333</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We have to transform them.</span></span></span>
<span class="r-in"><span><span class="fu">occuCOP</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">umf</span>,</span></span>
<span class="r-in"><span>  psiformula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  lambdaformula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  psistarts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="va">psi_init</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  lambdastarts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">lambda_init</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> occuCOP(data = umf, psiformula = ~1, lambdaformula = ~1, psistarts = qlogis(psi_init), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lambdastarts = log(lambda_init))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Occupancy probability (logit-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimate    SE     z P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    -0.377 0.207 -1.82  0.0683</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Detection rate (log-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimate     SE     z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -1.64 0.0805 -20.4 4.11e-92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 320.7247 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of sites: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If we have covariates, we need to have the right length for the start vectors.</span></span></span>
<span class="r-in"><span><span class="co"># psi ~ landuse --&gt; 3 param to estimate: Intercept, landuseForest, landuseGrassland</span></span></span>
<span class="r-in"><span><span class="co"># lambda ~ wind --&gt; 2 param to estimate: Intercept, wind</span></span></span>
<span class="r-in"><span><span class="fu">occuCOP</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">umf</span>,</span></span>
<span class="r-in"><span>  psiformula <span class="op">=</span> <span class="op">~</span> <span class="va">landuse</span>,</span></span>
<span class="r-in"><span>  lambdaformula <span class="op">=</span> <span class="op">~</span> <span class="va">wind</span>,</span></span>
<span class="r-in"><span>  psistarts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="va">psi_init</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  lambdastarts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">lambda_init</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> occuCOP(data = umf, psiformula = ~landuse, lambdaformula = ~wind, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     psistarts = rep(qlogis(psi_init), 3), lambdastarts = rep(log(lambda_init), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         2))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Occupancy probability (logit-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate    SE     z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   -0.416 0.268 -1.55 1.20e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> landuse.L      1.074 0.460  2.33 1.96e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> landuse.Q     -1.984 0.461 -4.30 1.68e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Detection rate (log-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate    SE      z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   -2.520 0.178 -14.18 1.18e-45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> wind           0.651 0.088   7.39 1.43e-13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 262.6408 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of sites: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># And with covariates, we could have chosen better initial values, such as the</span></span></span>
<span class="r-in"><span><span class="co"># proportion of sites in which we have observations per land-use category.</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">psi_init_covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"City"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">rowSums</span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">landuse</span> <span class="op">==</span> <span class="st">"City"</span>, <span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Forest"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">rowSums</span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">landuse</span> <span class="op">==</span> <span class="st">"Forest"</span>, <span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Grassland"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">rowSums</span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">landuse</span> <span class="op">==</span> <span class="st">"Grassland"</span>, <span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      City    Forest Grassland </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1142857 0.7272727 0.3750000 </span>
<span class="r-in"><span><span class="fu">occuCOP</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">umf</span>,</span></span>
<span class="r-in"><span>  psiformula <span class="op">=</span> <span class="op">~</span> <span class="va">landuse</span>,</span></span>
<span class="r-in"><span>  lambdaformula <span class="op">=</span> <span class="op">~</span> <span class="va">wind</span>,</span></span>
<span class="r-in"><span>  psistarts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="va">psi_init_covs</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> occuCOP(data = umf, psiformula = ~landuse, lambdaformula = ~wind, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     psistarts = qlogis(psi_init_covs))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Occupancy probability (logit-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate    SE     z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   -0.416 0.268 -1.55 1.20e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> landuse.L      1.074 0.460  2.33 1.96e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> landuse.Q     -1.984 0.461 -4.30 1.68e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Detection rate (log-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate    SE      z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   -2.520 0.178 -14.18 1.18e-45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> wind           0.651 0.088   7.39 1.43e-13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 262.6408 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of sites: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can fit our model with a different optimisation algorithm.</span></span></span>
<span class="r-in"><span><span class="fu">occuCOP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">umf</span>, method <span class="op">=</span> <span class="st">"Nelder-Mead"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> occuCOP(data = umf, method = "Nelder-Mead")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Occupancy probability (logit-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimate    SE     z P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    -0.377 0.207 -1.82  0.0684</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Detection rate (log-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimate     SE     z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -1.64 0.0805 -20.4 4.12e-92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 320.7247 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of sites: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can run our model with a C++ or with a R likelihood function.</span></span></span>
<span class="r-in"><span><span class="co">## They give the same result. </span></span></span>
<span class="r-in"><span><span class="fu">occuCOP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">umf</span>, engine <span class="op">=</span> <span class="st">"C"</span>, psistarts <span class="op">=</span> <span class="fl">0</span>, lambdastarts <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> occuCOP(data = umf, psistarts = 0, lambdastarts = 0, engine = "C")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Occupancy probability (logit-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimate    SE     z P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    -0.377 0.207 -1.82  0.0683</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Detection rate (log-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimate     SE     z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -1.64 0.0805 -20.4 4.11e-92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 320.7247 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of sites: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu">occuCOP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">umf</span>, engine <span class="op">=</span> <span class="st">"R"</span>, psistarts <span class="op">=</span> <span class="fl">0</span>, lambdastarts <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> occuCOP(data = umf, psistarts = 0, lambdastarts = 0, engine = "R")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Occupancy probability (logit-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimate    SE     z P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    -0.377 0.207 -1.82  0.0683</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Detection rate (log-scale):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimate     SE     z  P(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -1.64 0.0805 -20.4 4.11e-92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 320.7247 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of sites: 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The C++ (the default) is faster.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">occuCOP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">umf</span>, engine <span class="op">=</span> <span class="st">"C"</span>, psistarts <span class="op">=</span> <span class="fl">0</span>, lambdastarts <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.005   0.000   0.004 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">occuCOP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">umf</span>, engine <span class="op">=</span> <span class="st">"R"</span>, psistarts <span class="op">=</span> <span class="fl">0</span>, lambdastarts <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.018   0.000   0.018 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## However, if you want to understand how the likelihood is calculated,</span></span></span>
<span class="r-in"><span><span class="co">## you can easily access the R likelihood function.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">occuCOP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">umf</span>, engine <span class="op">=</span> <span class="st">"R"</span>, psistarts <span class="op">=</span> <span class="fl">0</span>, lambdastarts <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">@</span><span class="va">nllFun</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (params) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     psi &lt;- plogis(Xpsi %*% params[psiIdx])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     lambda &lt;- exp(Xlambda %*% params[lambdaIdx])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (length(sitesRemoved) &gt; 0) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         siteAnalysed = (1:M)[-sitesRemoved]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         siteAnalysed = (1:M)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     iProb &lt;- rep(NA, M)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (i in siteAnalysed) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         iIdxall &lt;- ((i - 1) * J + 1):(i * J)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         iIdx = iIdxall[!removed_obsvec[iIdxall]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (SitesWithDetec[i]) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             iProb[i] = psi[i] * ((sum(lambda[iIdx] * Lvec[iIdx]))^sum(yvec[iIdx])/factorial(sum(yvec[iIdx])) * </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 exp(-sum(lambda[iIdx] * Lvec[iIdx])))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             iProb[i] = psi[i] * exp(-sum(lambda[iIdx] * Lvec[iIdx])) + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 (1 - psi[i])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ll = sum(log(iProb[siteAnalysed]))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return(-ll)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x5d9fb7d0e018&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x5d9fba779228&gt;</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Finally, if you do not want to fit your model but only get the likelihood,</span></span></span>
<span class="r-in"><span><span class="co"># you can get the negative log-likelihood for a given set of parameters.</span></span></span>
<span class="r-in"><span><span class="fu">occuCOP</span><span class="op">(</span>data <span class="op">=</span> <span class="va">umf</span>, return.negloglik <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"psi"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span>, <span class="st">"lambda"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"psi"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>, <span class="st">"lambda"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"psi"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="fl">0.75</span><span class="op">)</span>, <span class="st">"lambda"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   logit(psi).(Intercept) log(lambda).(Intercept)       nll</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1              -1.098612               0.6931472 1294.2149</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2               0.000000               0.0000000  565.8794</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3               1.098612              -0.6931472  286.3071</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://chandlerlab.uga.edu/richard-chandler-phd/" class="external-link">Richard Chandler</a>, <a href="https://kenkellner.com" class="external-link">Ken Kellner</a>, Ian Fiske, David Miller, Andy Royle, Jeff Hostetler, Rebecca Hutchinson, Adam Smith, Lea Pautrel.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

