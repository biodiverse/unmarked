<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modeling variation in abundance using capture-recapture data • unmarked</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modeling variation in abundance using capture-recapture data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unmarked</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/unmarked.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cap-recap.html">Modeling variation in abundance using capture-recapture data</a>
    </li>
    <li>
      <a href="../articles/colext.html">Dynamic occupancy models in unmarked</a>
    </li>
    <li>
      <a href="../articles/contributing_to_unmarked.html">Contributing to unmarked: guide to adding a new model to `unmarked`</a>
    </li>
    <li>
      <a href="../articles/distsamp.html">Distance sampling analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/occuMulti.html">Multispecies occupancy models with occuMulti</a>
    </li>
    <li>
      <a href="../articles/powerAnalysis.html">Power Analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/simulate.html">Simulating datasets</a>
    </li>
    <li>
      <a href="../articles/spp-dist.html">Modeling and mapping species distributions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hmecology/unmarked/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="cap-recap_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Modeling variation in abundance using capture-recapture data</h1>
                        <h4 data-toc-skip class="author">Richard Chandler</h4>
            
            <h4 data-toc-skip class="date">Feb 24, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hmecology/unmarked/blob/HEAD/vignettes/cap-recap.Rmd" class="external-link"><code>vignettes/cap-recap.Rmd</code></a></small>
      <div class="hidden name"><code>cap-recap.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h2>
<p>The “un” in <code>unmarked</code> is somewhat misleading because the package can be used to analyze data from marked animals. The three most common sampling methods that produce suitable data are removal sampling, double observer sampling, and capture-recapture methods. This document focuses on the analysis of capture-recapture data using a class of models known as multinomial <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>-mixture models <span class="citation">(Royle 2004, Dorazio et al. 2005)</span>, which assume that capture-recapture data have been collected at a collection of sample locations (“sites”). Capture-recapture models can be fitted with constant parameters (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mn>0</mn></msub><annotation encoding="application/x-tex">M_0</annotation></semantics></math>), time-specific parameters (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>t</mi></msub><annotation encoding="application/x-tex">M_t</annotation></semantics></math>), and behavioral responses (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>b</mi></msub><annotation encoding="application/x-tex">M_b</annotation></semantics></math>). In addition, spatial variation in abundance and capture probability can also be modeled using covariates. <code>unmarked</code> has two functions for fitting capture-recapture models: <code>multinomPois</code> and <code>gmultmix</code>. Both allow for user-defined functions to describe the capture process, and the latter allows for modeling of temporary emigration when data have been collected using the so-called robust design <span class="citation">(Kendall et al. 1997, Chandler et al. 2011)</span>.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In traditional capture-recapture models, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> individuals are captured at a site during the course of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math> sampling occasions. The encounter history for each individual is used as information about capture probability <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> such that the total population size <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math> can be regarded as the size parameter of a binomial distribution, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>∼</mo><mtext mathvariant="normal">Binomial</mtext><mo stretchy="false" form="prefix">(</mo><mi>N</mi><mo>,</mo><mi>p</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">n \sim \mbox{Binomial}(N, p)</annotation></semantics></math>.</p>
<p>Although traditional capture-recapture models are useful for estimating population size when <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p&lt;1</annotation></semantics></math>, they do not allow one to model variation in abundance, which is a central focus of much ecological research. <span class="citation">Royle (2004)</span> and <span class="citation">Dorazio et al. (2005)</span> developed a framework for modeling variation in both abundance and capture probability when capture-recapture data are collected at a set of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math> sites. Site-specific abundance (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>i</mi></msub><mo>;</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">N_i; i=1,2,...,R</annotation></semantics></math>) is regarded as latent variable following a discrete distribution such as the Poisson or negative binomial. The encounter histories are then tabulated at each site so that they can be regarded as an outcome of a multinomial distribution with cell probabilities <span class="math inline">$\bf \pi$</span> determined by a protocol-specific function of capture probability. Assuming a Poisson distribution, the model can be written as <span class="math display">$$
\begin{gather}
  N_i \sim \mbox{Poisson}(\lambda) \nonumber \\
  {\bf y_i}|N_i \sim \mbox{Multinomial}(N_i, \pi(p))
  \label{mod}
\end{gather}
$$</span> In the above, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> is the expected number of individuals at each site. <span class="math inline">${\bf y_i}$</span> is a vector containing the number of individuals with encounter history <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>;</mo><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mi>K</mi></mrow><annotation encoding="application/x-tex">k; k=1,2,...K</annotation></semantics></math> at site <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>. The number of observable encounter histories <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math> depends on the sampling protocol. For a capture-recapture study with 2 occasions, there are 3 possible encounter histories <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>∈</mo><mo stretchy="false" form="prefix">(</mo><mn>11</mn><mo>,</mo><mn>10</mn><mo>,</mo><mn>01</mn><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">H \in (11, 10, 01)</annotation></semantics></math>. In Equation 1, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi><mo stretchy="false" form="prefix">(</mo><mi>p</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\pi(p)</annotation></semantics></math> is a function that that converts capture probability <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> to multinomial cell probabilities, , the proportion of individuals expected to have capture history <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>. For example, the cell probabilities corresponding to the capture histories listed above are</p>
<p><span class="math display">$$
{\bf \pi}(p) = \{ p^2, p(1-p), (1-p)p \}.
$$</span></p>
<p>The probability of not capturing an individual in this case (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mn>00</mn></mrow><annotation encoding="application/x-tex">H=00</annotation></semantics></math>) is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><msup><mo stretchy="false" form="postfix">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">(1-p)^2</annotation></semantics></math>.</p>
<p>Spatial variation in abundance can be modeled using covariates with a log-link function <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mo stretchy="false" form="prefix">(</mo><msub><mi>λ</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">
\log(\lambda_i) = \beta_0 + \beta_1 x_i
</annotation></semantics></math> where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math> is some site-specific covariate such as habitat type or elevation. Multiple covariates can be considered and a more general form of the above can be written as <span class="math inline">$\log(\lambda_i) = {\bf X}_i' \bf \beta$</span> where <span class="math inline">${\bf X}$</span> is a design matrix and <span class="math inline">${\bf \beta}$</span> is a vector of coefficients, possibly including an intercept. Capture probability can be modeled using the logit-link in much the same way <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">logit</mtext><mo stretchy="false" form="prefix">(</mo><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mn>1</mn></msub><msub><mi>v</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">
\text{logit}(p_{ij}) = \alpha_0 + \alpha_1 v_{ij}
</annotation></semantics></math> where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">v_{ij}</annotation></semantics></math> is some covariate specific to the site and capture occasion. When <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> is assumed to be constant, the model is often referred to as model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mn>0</mn></msub><annotation encoding="application/x-tex">M_0</annotation></semantics></math>. Alternatively, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> may be occasion-specific (model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>t</mi></msub><annotation encoding="application/x-tex">M_t</annotation></semantics></math>) or may be influenced by animal behavior (model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>b</mi></msub><annotation encoding="application/x-tex">M_b</annotation></semantics></math>). <span class="citation">Otis et al. (1978)</span> and <span class="citation">Williams et al. (2002)</span> are comprehensive references.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>As previously mentioned, the data required by <code>unmarked</code> are an <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>×</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">R \times K</annotation></semantics></math> matrix in which each row is the vector of tabulated encounter histories for animals captured at some site. Capture-recapture data, however, is typically recorded in the format shown in Table 1.</p>
<table class="table">
<caption>Table 1. Capture-recapture data for 6 individuals sampled on 3 occasions</caption>
<thead><tr class="header">
<th align="left">Animal ID</th>
<th align="center">Site</th>
<th align="center">Capture history</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">GB</td>
<td align="center">A</td>
<td align="center">101</td>
</tr>
<tr class="even">
<td align="left">YR</td>
<td align="center">A</td>
<td align="center">101</td>
</tr>
<tr class="odd">
<td align="left">RO</td>
<td align="center">A</td>
<td align="center">111</td>
</tr>
<tr class="even">
<td align="left">PP</td>
<td align="center">A</td>
<td align="center">100</td>
</tr>
<tr class="odd">
<td align="left">GY</td>
<td align="center">B</td>
<td align="center">100</td>
</tr>
<tr class="even">
<td align="left">PR</td>
<td align="center">B</td>
<td align="center">010</td>
</tr>
</tbody>
</table>
<p>In the absence of individual covariates, the data in Table 1 can be converted to the requisite format as shown in Table 2. Notice that no captures were made in sites C and D. It is important that such sites are retained in the analysis in order to make inference about spatial variation in abundance.</p>
<table class="table">
<caption>Table 2. Capture-recapture data from Table 1 in the format required by unmarked</caption>
<thead><tr class="header">
<th align="left">Site</th>
<th align="center">100</th>
<th align="center">010</th>
<th align="center">001</th>
<th align="center">110</th>
<th align="center">011</th>
<th align="center">101</th>
<th align="center">111</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="left">C</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="left">D</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="closed-population-models">Closed Population Models<a class="anchor" aria-label="anchor" href="#closed-population-models"></a>
</h2>
<div class="section level3">
<h3 id="models-m_0-m_t-and-models-with-covariates-of-p-">Models <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mn>0</mn></msub><annotation encoding="application/x-tex">M_0</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>t</mi></msub><annotation encoding="application/x-tex">M_t</annotation></semantics></math>, and models with covariates of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>.<a class="anchor" aria-label="anchor" href="#models-m_0-m_t-and-models-with-covariates-of-p-"></a>
</h3>
<p>In this example we will analyze point count data collected on alder flycatchers (<em>Empidonax alnorum</em>) by <span class="citation">Chandler et al. (2009)</span>. Point count data such as these are collected on unmarked animals, but one can apply capture-recapture models because it is possible to keep track of individual birds during a short period of time <span class="citation">(Alldredge et al. 2007)</span>. That is, we can pretend like birds are marked by noting which time intervals they are detected in during a short survey. The alder flycatcher data were collected using fixed-area 15-minute point counts, which were divided into 3 5-minute intervals. Each point was surveyed 3 times during 2005. The following command imports the capture histories for 50 individuals detected in 2005 at 49 point count locations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alfl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"csv"</span>, <span class="st">"alfl.csv"</span>, package<span class="op">=</span><span class="st">"unmarked"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">alfl</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          id survey interval1 interval2 interval3</span></span>
<span><span class="co">## 1 crick1_05      1         1         1         1</span></span>
<span><span class="co">## 2 crick1_05      3         1         0         1</span></span>
<span><span class="co">## 3   his1_05      1         0         1         1</span></span>
<span><span class="co">## 4   his1_05      1         1         1         1</span></span>
<span><span class="co">## 5   his1_05      2         0         1         1</span></span></code></pre>
<p>We see 5 rows of data representing the encounter histories for 5 birds detected at 2 points during 3 survey occasions. From these 5 birds, it appears as though detection probability is high since each bird was detected during at least 2 of the three time intervals.</p>
<p>Associated with the bird data are site- and visit-specific covariates for each of the 49 sites. We can import these data using the following command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alfl.covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"csv"</span>, <span class="st">"alflCovs.csv"</span>,</span>
<span>    package<span class="op">=</span><span class="st">"unmarked"</span><span class="op">)</span>, row.names<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">alfl.covs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           struct woody time.1 time.2 time.3 date.1 date.2 date.3</span></span>
<span><span class="co">## crick1_05   5.45  0.30   8.68   8.73   5.72      6     25     34</span></span>
<span><span class="co">## his1_05     4.75  0.05   9.43   7.40   7.58     20     32     54</span></span>
<span><span class="co">## hisw1_05   14.70  0.35   8.25   6.70   7.62     20     32     47</span></span>
<span><span class="co">## hisw2_05    5.05  0.30   7.77   6.23   7.17     20     32     47</span></span>
<span><span class="co">## kenc1_05    4.15  0.10   9.57   9.55   5.73      8     27     36</span></span>
<span><span class="co">## kenc2_05    9.75  0.40   9.10   9.12   9.12      8     27     36</span></span></code></pre>
<p>Each row of this <code>data.frame</code> corresponds to a point count location. The variable <code>struct</code> is a measure of vegetation structure, and <code>woody</code> is the percent cover of woody vegetation at each of the 50-m radius plots. Time of day and date were measured for each of the three visits.</p>
<p>To format the data for <code>unmarked</code>, we need to tabulate the encounter histories for each site. Before doing so, let’s first put our capture histories in a single column. Let’s also be explicit about the levels of our factors for both the newly created <code>captureHistory</code> column and the point id column.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alfl</span><span class="op">$</span><span class="va">captureHistory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">alfl</span><span class="op">$</span><span class="va">interval1</span>, <span class="va">alfl</span><span class="op">$</span><span class="va">interval2</span>, <span class="va">alfl</span><span class="op">$</span><span class="va">interval3</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span><span class="va">alfl</span><span class="op">$</span><span class="va">captureHistory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">alfl</span><span class="op">$</span><span class="va">captureHistory</span>,</span>
<span>    levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"001"</span>, <span class="st">"010"</span>, <span class="st">"011"</span>, <span class="st">"100"</span>, <span class="st">"101"</span>, <span class="st">"110"</span>, <span class="st">"111"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Don't do this:</span></span>
<span><span class="co">#levels(alfl$id) &lt;- rownames(alfl.covs)</span></span>
<span><span class="va">alfl</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">alfl</span><span class="op">$</span><span class="va">id</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">alfl.covs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Specifying the levels of <code>captureHistory</code> ensures that when we tabulate the encounter histories, we will include zeros for histories that were not observed. Similarly, setting the levels of <code>alfl$id</code> tells <code>R</code> that there were some sites where no ALFL were detected. This way, when we tabulate the data, we get a frequency for each site, not just the ones with &gt;1 detection. Here are the commands to extract data from the first primary period and to tabulate the encounter histories.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alfl.v1</span> <span class="op">&lt;-</span> <span class="va">alfl</span><span class="op">[</span><span class="va">alfl</span><span class="op">$</span><span class="va">survey</span><span class="op">==</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="va">alfl.H1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">alfl.v1</span><span class="op">$</span><span class="va">id</span>, <span class="va">alfl.v1</span><span class="op">$</span><span class="va">captureHistory</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">alfl.H1</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            </span></span>
<span><span class="co">##             001 010 011 100 101 110 111</span></span>
<span><span class="co">##   crick1_05   0   0   0   0   0   0   1</span></span>
<span><span class="co">##   his1_05     0   0   1   0   0   0   1</span></span>
<span><span class="co">##   hisw1_05    0   0   0   0   0   0   0</span></span>
<span><span class="co">##   hisw2_05    0   0   0   0   0   0   1</span></span>
<span><span class="co">##   kenc1_05    0   0   0   0   0   0   0</span></span></code></pre>
<p>The object <code>alfl.H1</code> contains the tabulated capture histories for each site. This is the format required by <code>unmarked</code>. The data from the first 5 sites suggest that detection probability was high since the most common encounter history was <code>111</code>.</p>
<p>Now we are almost ready to create our <code>unmarkedFrame</code> and begin fitting models. We will fit our first series of models using the <code>multinomPois</code> function, which requires data formated using the <code>unmarkedFrameMPois</code> function. This constructor function has an argument , which currently can be set to <code>"removal"</code> or <code>"double"</code>, corresponding to removal sampling data and double observer sampling respectively. In doing so, the function automatically creates the function to convert <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> to <span class="math inline">${\bf \pi}$</span>. If <code>type</code> is missing, however, the user needs to specify a function to convert detection probability to multinomial cell probabilities. In the future, we may add an  option to automatically handle standard capture-recapture data too, but here we show how to supply it using a user-defined <code>piFun</code>, which allows flexibility in converting detection probability to multinomial cell probabilities <span class="math inline">$\bf \pi$</span>. The <code>piFun</code> must take a matrix of detection probabilities with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math> columns (3 in this case), and convert them to a matrix of multinomial cell probabilities with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math> columns. Each column corresponds to the probability of observing the encounter history <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>. Here is a <code>piFun</code> to compute the multinomial cell probabilities when there were 3 sampling occasions. This function allows us to fit models <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mn>0</mn></msub><annotation encoding="application/x-tex">M_0</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>t</mi></msub><annotation encoding="application/x-tex">M_t</annotation></semantics></math>, or models with covariates of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crPiFun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"001"</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p2</span><span class="op">)</span> <span class="op">*</span> <span class="va">p3</span>,</span>
<span>          <span class="st">"010"</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p1</span><span class="op">)</span> <span class="op">*</span> <span class="va">p2</span>     <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p3</span><span class="op">)</span>,</span>
<span>          <span class="st">"011"</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p1</span><span class="op">)</span> <span class="op">*</span> <span class="va">p2</span>     <span class="op">*</span> <span class="va">p3</span>,</span>
<span>          <span class="st">"100"</span> <span class="op">=</span> <span class="va">p1</span>     <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p3</span><span class="op">)</span>,</span>
<span>          <span class="st">"101"</span> <span class="op">=</span> <span class="va">p1</span>     <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p2</span><span class="op">)</span> <span class="op">*</span> <span class="va">p3</span>,</span>
<span>          <span class="st">"110"</span> <span class="op">=</span> <span class="va">p1</span>     <span class="op">*</span> <span class="va">p2</span>     <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p3</span><span class="op">)</span>,</span>
<span>          <span class="st">"111"</span> <span class="op">=</span> <span class="va">p1</span>     <span class="op">*</span> <span class="va">p2</span>     <span class="op">*</span> <span class="va">p3</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>To demonstrate how this works, imagine that we surveyed 2 sites and detection probability was constant (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">p=0.2</annotation></semantics></math>) among sites and survey occasions. The function converts these capture probabilities to multinomial cell probabilities. Note that these cell probabilities will sum to &lt;1 if capture probability is less than 1 over the 3 occasions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">crPiFun</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        001   010   011   100   101   110   111</span></span>
<span><span class="co">## [1,] 0.144 0.144 0.096 0.144 0.096 0.096 0.064</span></span>
<span><span class="co">## [2,] 0.144 0.144 0.096 0.144 0.096 0.096 0.064</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu">crPiFun</span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.784 0.784</span></span></code></pre>
<p>When providing a user-defined , we also need to provide information about how to handle missing values. That is, if we have a missing value in a covariate, we need to know which values of <span class="math inline">${\bf y}$</span> are affected. In <code>unmarked</code>, this can be done by supplying a mapping-matrix to the <code>obsToY</code> argument in the <code>unmarkedFrameMPois</code> function. <code>obsToY</code> needs to be a matrix of zeros and ones with the number of rows equal to the number of columns for some obsCov, and the number columns equal to the number of columns in <span class="math inline">${\bf y}$</span>. If <code>obsToY[j,k]</code>=1, then a missing value in <code>obsCov[i,j]</code> translates to a missing value in <code>y[i,k]</code>. For the capture-recapture data considered here, we can set all elements of <code>obsToY</code> to 1.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">o2y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>We are now ready to create the <code>unmarkedFrame</code>. In order to fit model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>t</mi></msub><annotation encoding="application/x-tex">M_t</annotation></semantics></math>, we need a covariate that references the time interval , which we call <code>intervalMat</code> below. We also provide a couple of site-specific covariates: the percent cover of woody vegetation and vegetation structure.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://groups.google.com/d/forum/unmarked" class="external-link">unmarked</a></span><span class="op">)</span></span>
<span><span class="va">intervalMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span>,<span class="st">'2'</span>,<span class="st">'3'</span><span class="op">)</span>, <span class="fl">50</span>, <span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">alfl.H1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"matrix"</span></span>
<span><span class="va">umf.cr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFrameMPois.html">unmarkedFrameMPois</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">alfl.H1</span>,</span>
<span>    siteCovs<span class="op">=</span><span class="va">alfl.covs</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"woody"</span>, <span class="st">"struct"</span>, <span class="st">"time.1"</span>, <span class="st">"date.1"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    obsCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>interval<span class="op">=</span><span class="va">intervalMat</span><span class="op">)</span>,</span>
<span>    obsToY<span class="op">=</span><span class="va">o2y</span>, piFun<span class="op">=</span><span class="st">"crPiFun"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: obsCovs contains characters. Converting them to factors.</span></span></code></pre>
<p>Writing a <code>piFun</code> and creating the <code>obsToY</code> object are the hardest parts of a capture-recapture analysis in <code>unmarked</code>. Again, this is done automatically for removal models and double observer models, and we may add an option to do this automatically for capture-recapture data too, but hopefully the flexibility allowed by specifying user-defined functions is evident.</p>
<p>Now that we have our data formatted we can fit some models. The following correspond to model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mn>0</mn></msub><annotation encoding="application/x-tex">M_0</annotation></semantics></math>, model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>t</mi></msub><annotation encoding="application/x-tex">M_t</annotation></semantics></math>, and a model with a continuous covariate effect on <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multinomPois.html">multinomPois</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span> <span class="op">~</span><span class="fl">1</span>, <span class="va">umf.cr1</span>, engine<span class="op">=</span><span class="st">"R"</span><span class="op">)</span></span>
<span><span class="va">Mt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multinomPois.html">multinomPois</a></span><span class="op">(</span><span class="op">~</span><span class="va">interval</span><span class="op">-</span><span class="fl">1</span> <span class="op">~</span><span class="fl">1</span>, <span class="va">umf.cr1</span>, engine<span class="op">=</span><span class="st">"R"</span><span class="op">)</span></span>
<span><span class="va">Mx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multinomPois.html">multinomPois</a></span><span class="op">(</span><span class="op">~</span><span class="va">time.1</span> <span class="op">~</span><span class="fl">1</span>, <span class="va">umf.cr1</span>, engine<span class="op">=</span><span class="st">"R"</span><span class="op">)</span></span></code></pre></div>
<p>The first two models can be fit in other software programs. What is unique about <code>unmarked</code> is that we can also model variation in abundance and detection probability among sites. The following model treats abundance as a function of the percent cover of woody vegetation.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">M0.woody</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multinomPois.html">multinomPois</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span> <span class="op">~</span><span class="va">woody</span>, <span class="va">umf.cr1</span>, engine<span class="op">=</span><span class="st">"R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## multinomPois(formula = ~1 ~ woody, data = umf.cr1, engine = "R")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Abundance:</span></span>
<span><span class="co">##             Estimate    SE     z  P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)   -0.962 0.325 -2.96 0.003059</span></span>
<span><span class="co">## woody          2.587 0.680  3.80 0.000143</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection:</span></span>
<span><span class="co">##  Estimate    SE    z  P(&gt;|z|)</span></span>
<span><span class="co">##      1.43 0.216 6.63 3.42e-11</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC: 245.9301</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>woody<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span>, length<span class="op">=</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">E.abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict-methods.html">predict</a></span><span class="op">(</span><span class="va">M0.woody</span>, type<span class="op">=</span><span class="st">"state"</span>, newdata<span class="op">=</span><span class="va">nd</span>, appendData<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Predicted</span> <span class="op">~</span> <span class="va">woody</span>, <span class="va">E.abundance</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Alder flycatchers / plot"</span>, xlab<span class="op">=</span><span class="st">"Woody vegetation cover"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">lower</span> <span class="op">~</span> <span class="va">woody</span>, <span class="va">E.abundance</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">gray</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">upper</span> <span class="op">~</span> <span class="va">woody</span>, <span class="va">E.abundance</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">gray</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="cap-recap_files/figure-html/unnamed-chunk-14-1.png" width="480"></p>
<p>What about detection probability? Since there was no evidence of variation in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>, we can simply back-transform the logit-scale estimate to obtain <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>p</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{p}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/backTransform-methods.html">backTransform</a></span><span class="op">(</span><span class="va">M0.woody</span>, type<span class="op">=</span><span class="st">"det"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Backtransformed linear combination(s) of Detection estimate(s)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Estimate     SE LinComb (Intercept)</span></span>
<span><span class="co">##     0.808 0.0336    1.43           1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Transformation: logistic</span></span></code></pre>
<p>As suggested by the raw data, detection probability was very high. The corresponding multinomial cell probabilities can be computed by plugging this estimate of detection probability into our <code>piFun</code>. This <code>getP</code> function makes this easy.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/getP-methods.html">getP</a></span><span class="op">(</span><span class="va">M0.woody</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##  001  010  011  100  101  110  111 </span></span>
<span><span class="co">## 0.03 0.03 0.13 0.03 0.13 0.13 0.53</span></span></code></pre>
<p>Note that the encounter probability most likely to be observed was 111. In fact <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> was so high that the probability of not detecting an alder flycatcher was essentially zero, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo>−</mo><mn>0.81</mn><msup><mo stretchy="false" form="postfix">)</mo><mn>3</mn></msup><mo>=</mo><mn>0.007</mn></mrow><annotation encoding="application/x-tex">(1-0.81)^3 = 0.007</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="modeling-behavioral-responses-model-m_b">Modeling behavioral responses, Model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>b</mi></msub><annotation encoding="application/x-tex">M_b</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#modeling-behavioral-responses-model-m_b"></a>
</h3>
<p>An animal’s behavior might change after being captured. Both trap avoidance and trap attraction are frequently observed in a variety of taxa. A simple model of these two behaviors is known as model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>b</mi></msub><annotation encoding="application/x-tex">M_b</annotation></semantics></math><span class="citation">(Otis et al. 1978)</span>. The model assumes that newly-captured individuals are captured with probability <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>n</mi><mi>a</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow></msub><annotation encoding="application/x-tex">p_{naive}</annotation></semantics></math> and then are subsequently recaptured with probability <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub><annotation encoding="application/x-tex">p_{wise}</annotation></semantics></math>. If <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>&lt;</mo><msub><mi>p</mi><mrow><mi>n</mi><mi>a</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{wise} &lt; p_{naive}</annotation></semantics></math>, then animals exhibit trap avoidance. In some cases, such as when traps are baited, we might observed <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>&gt;</mo><msub><mi>p</mi><mrow><mi>n</mi><mi>a</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{wise} &gt; p_{naive}</annotation></semantics></math> in which case the animals are said to be “trap-happy”.</p>
<p>To fit model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>b</mi></msub><annotation encoding="application/x-tex">M_b</annotation></semantics></math> in <code>unmarked</code>, we need to create a new <code>piFun</code> and we need to provide an occasion-specific covariate (<code>obsCov</code>) that distinguishes the two capture probabilities, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>n</mi><mi>a</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow></msub><annotation encoding="application/x-tex">p_{naive}</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub><annotation encoding="application/x-tex">p_{wise}</annotation></semantics></math>. The simplest possible approach is the following</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crPiFun.Mb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span> <span class="co"># p should have 3 columns</span></span>
<span>    <span class="va">pNaive</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">pWise</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="st">"001"</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pNaive</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pNaive</span><span class="op">)</span> <span class="op">*</span> <span class="va">pNaive</span>,</span>
<span>          <span class="st">"010"</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pNaive</span><span class="op">)</span> <span class="op">*</span> <span class="va">pNaive</span>     <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pWise</span><span class="op">)</span>,</span>
<span>          <span class="st">"011"</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pNaive</span><span class="op">)</span> <span class="op">*</span> <span class="va">pNaive</span>     <span class="op">*</span> <span class="va">pWise</span>,</span>
<span>          <span class="st">"100"</span> <span class="op">=</span> <span class="va">pNaive</span>     <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pWise</span><span class="op">)</span>  <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pWise</span><span class="op">)</span>,</span>
<span>          <span class="st">"101"</span> <span class="op">=</span> <span class="va">pNaive</span>     <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pWise</span><span class="op">)</span>  <span class="op">*</span> <span class="va">pWise</span>,</span>
<span>          <span class="st">"110"</span> <span class="op">=</span> <span class="va">pNaive</span>     <span class="op">*</span> <span class="va">pWise</span>      <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">pWise</span><span class="op">)</span>,</span>
<span>          <span class="st">"111"</span> <span class="op">=</span> <span class="va">pNaive</span>     <span class="op">*</span> <span class="va">pWise</span>      <span class="op">*</span> <span class="va">pWise</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function <code>crPiFun.Mb</code> allows capture probability to be modeled as <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">logit</mtext><mo stretchy="false" form="prefix">(</mo><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo><mo>=</mo><msub><mi>α</mi><mrow><mi>n</mi><mi>a</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow></msub><mo>+</mo><msub><mi>α</mi><mrow><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub><mi>b</mi><mi>e</mi><mi>h</mi><mi>a</mi><mi>v</mi><mi>i</mi><mi>o</mi><msub><mi>r</mi><mi>j</mi></msub><mo>+</mo><msub><mi>α</mi><mn>1</mn></msub><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">
\text{logit}(p_{ij}) = \alpha_{naive} + \alpha_{wise} behavior_j + \alpha_1 x_i
</annotation></semantics></math> where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>e</mi><mi>h</mi><mi>a</mi><mi>v</mi><mi>i</mi><mi>o</mi><msub><mi>r</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">behavior_j</annotation></semantics></math> is simply a dummy variable. Thus, when no site-specific covariates (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math>) are included, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">p_{ij}</annotation></semantics></math> is either <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>n</mi><mi>a</mi><mi>i</mi><mi>v</mi><mi>e</mi></mrow></msub><annotation encoding="application/x-tex">p_{naive}</annotation></semantics></math> or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mrow><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></msub><annotation encoding="application/x-tex">p_{wise}</annotation></semantics></math>. The following code constructs a new <code>unmarkedFrame</code> and fits model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>b</mi></msub><annotation encoding="application/x-tex">M_b</annotation></semantics></math> to the alder flycatcher data.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">behavior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Naive'</span>,<span class="st">'Naive'</span>,<span class="st">'Wise'</span><span class="op">)</span>, <span class="fl">50</span>, <span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">umf.cr1Mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFrameMPois.html">unmarkedFrameMPois</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">alfl.H1</span>,</span>
<span>    siteCovs<span class="op">=</span><span class="va">alfl.covs</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"woody"</span>, <span class="st">"struct"</span>, <span class="st">"time.1"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    obsCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>behavior<span class="op">=</span><span class="va">behavior</span><span class="op">)</span>,</span>
<span>    obsToY<span class="op">=</span><span class="va">o2y</span>, piFun<span class="op">=</span><span class="st">"crPiFun.Mb"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: obsCovs contains characters. Converting them to factors.</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multinomPois.html">multinomPois</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span> <span class="op">~</span><span class="fl">1</span>, <span class="va">umf.cr1Mb</span>, engine<span class="op">=</span><span class="st">"R"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">Mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multinomPois.html">multinomPois</a></span><span class="op">(</span><span class="op">~</span><span class="va">behavior</span><span class="op">-</span><span class="fl">1</span> <span class="op">~</span><span class="fl">1</span>, <span class="va">umf.cr1Mb</span>, engine<span class="op">=</span><span class="st">"R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## multinomPois(formula = ~behavior - 1 ~ 1, data = umf.cr1Mb, engine = "R")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Abundance:</span></span>
<span><span class="co">##  Estimate    SE      z P(&gt;|z|)</span></span>
<span><span class="co">##   0.00955 0.142 0.0674   0.946</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection:</span></span>
<span><span class="co">##               Estimate    SE    z  P(&gt;|z|)</span></span>
<span><span class="co">## behaviorNaive     1.31 0.356 3.69 2.25e-04</span></span>
<span><span class="co">## behaviorWise      1.50 0.276 5.44 5.27e-08</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC: 260.0599</span></span></code></pre>
<p>AIC gives us no reason to favor model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>b</mi></msub><annotation encoding="application/x-tex">M_b</annotation></semantics></math> over model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mn>0</mn></msub><annotation encoding="application/x-tex">M_0</annotation></semantics></math>. This is perhaps not too surprising given that the alder flycatchers were not actually captured. Here is a command to compute 95% confidence intervals for the two detection probabilities.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">Mb</span>, type<span class="op">=</span><span class="st">"det"</span>, method<span class="op">=</span><span class="st">"profile"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Profiling parameter 1 of 2 ... done.</span></span>
<span><span class="co">## Profiling parameter 2 of 2 ... done.</span></span></code></pre>
<pre><code><span><span class="co">##                      0.025     0.975</span></span>
<span><span class="co">## p(behaviorNaive) 0.6490219 0.8846530</span></span>
<span><span class="co">## p(behaviorWise)  0.7290778 0.8890318</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="caution-warning-danger">Caution, Warning, Danger<a class="anchor" aria-label="anchor" href="#caution-warning-danger"></a>
</h3>
<p>The function <code>crPiFun.Mb</code> is not generic and could easily be abused. For example, you would get bogus results if you tried to use this function to fit model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mrow><mi>b</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">M_{bt}</annotation></semantics></math>, or if you incorrectly formatted the <code>behavior</code> covariate. Thus, extreme caution is advised when writing user-defined <code>piFun</code>s.</p>
<p>There are also a few limitations regarding user-defined <code>piFun</code>s. First, they can only take a single argument <code>p</code>, which must be the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>×</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">R \times J</annotation></semantics></math> matrix of detection probabilities. This makes it cumbersome to fit models such as model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>h</mi></msub><annotation encoding="application/x-tex">M_h</annotation></semantics></math> as described below. It also makes it impossible to fit models such as model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mrow><mi>b</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">M_{bt}</annotation></semantics></math>. It would be better if <code>piFun</code>s could accept multiple arguments, but this would require some modifications to <code>multinomPois</code> and <code>gmultmix</code>, which we may do in the future.</p>
</div>
<div class="section level3">
<h3 id="individual-heterogeneity-in-capture-probability-model-m_h">Individual Heterogeneity in Capture Probability, Model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>h</mi></msub><annotation encoding="application/x-tex">M_h</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#individual-heterogeneity-in-capture-probability-model-m_h"></a>
</h3>
<p>The capture-recapture models covered thus far assume that variation in capture probability can be explained by site-specific covariates, time, or behavior. Currently, <code>unmarked</code> can not fit so-called individual covariate models, in which heterogeneity in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math> is attributable to animal-specific covariates. However, one could partition the data into strata and analyze the strata separately. For example, sex-specific differences could be studied by dividing the data on males and females into 2 subsets.</p>
<p>Although individual covariate models cannot be considered, it is possible to fit model <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>h</mi></msub><annotation encoding="application/x-tex">M_h</annotation></semantics></math>, which assumes random variation in capture probability among individuals. Here is a <code>piFun</code>, based on code by Andy Royle. It assumes a logit-normal distribution for the random effects <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">logit</mtext><mo stretchy="false" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>∼</mo><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mo stretchy="false" form="prefix">(</mo><mi>μ</mi><mo>,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="false" form="postfix">)</mo><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mbox{logit}(p_i) \sim Normal(\mu, \sigma^2).
</annotation></semantics></math> These random effects are integrated out of the likelihood to obtain the marginal probability of capture.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MhPiFun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># logit(p)</span></span>
<span><span class="va">sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">qlogis</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="va">il</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow<span class="op">=</span><span class="va">M</span>, ncol<span class="op">=</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">il</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"001"</span>,<span class="st">"010"</span>,<span class="st">"011"</span>,<span class="st">"100"</span>,<span class="st">"101"</span>,<span class="st">"110"</span>,<span class="st">"111"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">M</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">il</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0</span>,<span class="va">sig</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, lower<span class="op">=</span><span class="op">-</span><span class="cn">Inf</span>, upper<span class="op">=</span><span class="cn">Inf</span>, stop.on.error<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="va">il</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0</span>,<span class="va">sig</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, lower<span class="op">=</span><span class="op">-</span><span class="cn">Inf</span>, upper<span class="op">=</span><span class="cn">Inf</span>, stop.on.error<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="va">il</span><span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0</span>,<span class="va">sig</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, lower<span class="op">=</span><span class="op">-</span><span class="cn">Inf</span>, upper<span class="op">=</span><span class="cn">Inf</span>, stop.on.error<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="va">il</span><span class="op">[</span><span class="va">i</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0</span>,<span class="va">sig</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, lower<span class="op">=</span><span class="op">-</span><span class="cn">Inf</span>, upper<span class="op">=</span><span class="cn">Inf</span>, stop.on.error<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="va">il</span><span class="op">[</span><span class="va">i</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0</span>,<span class="va">sig</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, lower<span class="op">=</span><span class="op">-</span><span class="cn">Inf</span>, upper<span class="op">=</span><span class="cn">Inf</span>, stop.on.error<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="va">il</span><span class="op">[</span><span class="va">i</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0</span>,<span class="va">sig</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, lower<span class="op">=</span><span class="op">-</span><span class="cn">Inf</span>, upper<span class="op">=</span><span class="cn">Inf</span>, stop.on.error<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="va">il</span><span class="op">[</span><span class="va">i</span>,<span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">+</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">0</span>,<span class="va">sig</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, lower<span class="op">=</span><span class="op">-</span><span class="cn">Inf</span>, upper<span class="op">=</span><span class="cn">Inf</span>, stop.on.error<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">il</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function does not allow for temporal variation in capture probability because we are using the second column of <code>p</code> as <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>, the parameter governing the variance of the random effects. Once again, this is somewhat clumsy and it would be better to allow <code>piFun</code> to accept additional arguments, which could be controlled from <code>multinomPois</code> using an additional <code>formula</code>. Such features may be added eventually.</p>
<p>Having defined our new <code>piFun</code>, we can fit the model as follows</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'p'</span>,<span class="st">'sig'</span>,<span class="st">'sig'</span><span class="op">)</span>, <span class="fl">50</span>, <span class="fl">3</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">umf.cr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFrameMPois.html">unmarkedFrameMPois</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">alfl.H1</span>,</span>
<span>  siteCovs<span class="op">=</span><span class="va">alfl.covs</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"woody"</span>, <span class="st">"struct"</span>, <span class="st">"time.1"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  obsCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parID<span class="op">=</span><span class="va">parID</span><span class="op">)</span>,</span>
<span>  obsToY<span class="op">=</span><span class="va">o2y</span>, piFun<span class="op">=</span><span class="st">"MhPiFun"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/multinomPois.html">multinomPois</a></span><span class="op">(</span><span class="op">~</span><span class="va">parID</span><span class="op">-</span><span class="fl">1</span> <span class="op">~</span><span class="va">woody</span>, <span class="va">umf.cr2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Call:</span></span>
<span><span class="co">## multinomPois(formula = ~parID - 1 ~ woody, data = umf.cr2)</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## Abundance:</span></span>
<span><span class="co">##             Estimate    SE     z P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)    -0.84 0.363 -2.31 0.02078</span></span>
<span><span class="co">## woody           2.59 0.680  3.81 0.00014</span></span>
<span><span class="co">##</span></span>
<span><span class="co">## Detection:</span></span>
<span><span class="co">##          Estimate    SE    z P(&gt;|z|)</span></span>
<span><span class="co">## parIDp      1.637 0.645 2.54  0.0112</span></span>
<span><span class="co">## parIDsig    0.841 0.622 1.35  0.1762</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC: 242.3731</span></span></code></pre>
<p>The estimate of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math> is high, indicating the existence of substantial heterogeneity in detection probability. However, one should be aware of the concerns about <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>h</mi></msub><annotation encoding="application/x-tex">M_h</annotation></semantics></math> raised by <span class="citation">Link (2003)</span> who demonstrated that population size <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math> is not an identifiable parameter among various classes of models assumed for the random effects. For example, we might use a beta distribution rather than a logit-normal distribution, and obtain very different estimates of abundance. <span class="citation">Link (2003)</span> demonstrated that conventional methods such as AIC cannot be used to discriminate among these models.</p>
</div>
<div class="section level3">
<h3 id="distance-related-heterogeneity">Distance-related heterogeneity<a class="anchor" aria-label="anchor" href="#distance-related-heterogeneity"></a>
</h3>
<p>Another source of individual heterogeneity in capture probability arises from the distance between animal activity centers and sample locations. Traditional capture-recapture models ignore this important source of variation in capture probability, but recently developed spatial capture-recapture (SCR) models overcome this limitation <span class="citation">(Efford 2004, Royle and Dorazio 2008, Royle and Young 2008)</span>. Distance-related heterogeneity in detection probability was probably not an important concern in the alder flycatcher dataset because the plots were very small (0.785 ha) and only singing birds were included in the analysis. If it were a concern, we could of course collect distance data and use the <code>gdistsamp</code> function to fit a distance sampling model. In other contexts, such as when using arrays of live traps, distance sampling is not an option and SCR models offer numerous advantages over traditional capture-recapture models.</p>
</div>
</div>
<div class="section level2">
<h2 id="modeling-temporary-emigration">Modeling Temporary Emigration<a class="anchor" aria-label="anchor" href="#modeling-temporary-emigration"></a>
</h2>
<p>In the previous analysis we used data from the first visit only. <span class="citation">Chandler et al. (2011)</span> proposed a model that allows us to make use of the entire alder flycatcher dataset. The model is similar to the temporary emigration model of <span class="citation">Kendall et al. (1997)</span> except that we are interested in modeling variation in abundance among sites.</p>
<p>The model assumes that no births or deaths occur during the study period, but animals may move on and off the plots between sampling occasions. This type of movement is referred to as temporary emigration. To account for it, define <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>i</mi></msub><annotation encoding="application/x-tex">M_i</annotation></semantics></math> to be the super-population size, the total number of individuals that use site <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> during the study period. Assume that we visit each site on <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math> primary periods and define <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mrow><mi>i</mi><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">N_{it}</annotation></semantics></math> to be the subset of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>M</mi><mi>i</mi></msub><annotation encoding="application/x-tex">M_i</annotation></semantics></math> exposed to sampling during primary period <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>. We now collect capture-recapture data at each site during each primary period, and obtain the data <span class="math inline">$\bf y_{it}$</span>. The model can be written as <span class="math display">$$
\begin{gather}
  M_i \sim \mbox{Poisson}(\lambda) \nonumber \\
  N_{it}|M_i \sim \mbox{Binomial}(M_i, \phi) \nonumber \\
  {\bf y_{it}}|N_{it} \sim \mbox{Multinomial}(N_{it}, \pi(p))
  \label{mod:te}
\end{gather}
$$</span> where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math> is the probability of being available for capture. This can be modeled as a function of covariates using the logit-link.</p>
<p>The data structure for the robust design is more complex than before, but it is easy to create in <code>R</code>. We can once again use the <code>table</code> function - but this time, we create a three-dimensional table rather than a two-dimensional one. We also need to expand the <code>obsToY</code> mapping matrix so that it has a block diagonal structure. This isn’t so intuitive, but the commands below are generic and can be applied to other capture-recapture designs.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alfl.H</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">alfl</span><span class="op">$</span><span class="va">id</span>, <span class="va">alfl</span><span class="op">$</span><span class="va">captureHistory</span>, <span class="va">alfl</span><span class="op">$</span><span class="va">survey</span><span class="op">)</span></span>
<span><span class="va">alfl.Hmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">alfl.H</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">]</span>, <span class="va">alfl.H</span><span class="op">[</span>,,<span class="fl">2</span><span class="op">]</span>, <span class="va">alfl.H</span><span class="op">[</span>,,<span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">nVisits</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">o2yGMM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">nVisits</span><span class="op">)</span>, <span class="va">o2y</span><span class="op">)</span></span>
<span><span class="va">umf.cr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedMultFrame.html">unmarkedFrameGMM</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">alfl.Hmat</span>,</span>
<span>    siteCovs<span class="op">=</span><span class="va">alfl.covs</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"woody"</span>, <span class="st">"struct"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    yearlySiteCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>date<span class="op">=</span><span class="va">alfl.covs</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, time<span class="op">=</span><span class="va">alfl.covs</span><span class="op">[</span>,<span class="fl">6</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    obsCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>interval<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">intervalMat</span>,<span class="va">intervalMat</span>,<span class="va">intervalMat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    obsToY<span class="op">=</span><span class="va">o2yGMM</span>, piFun<span class="op">=</span><span class="st">"crPiFun"</span>, numPrimary<span class="op">=</span><span class="va">nVisits</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: obsCovs contains characters. Converting them to factors.</span></span></code></pre>
<p>Notice that we have 3 types of covariates now. The site-specific covariates are the same as before. Now, however, the observation covariates must match the dimensions of the <span class="math inline">${\bf y}$</span> matrix. We can also have a class of covariates that vary among primary periods but not within primary periods. These are called <code>yearlySiteCovs</code>, which is a misleading name. It is a carry-over from other “open population” models in <code>unmarked</code>, but it should be remembered that these models are most suitable for data from a single year, since we assume no births or mortalities.</p>
<p>We can fit the model using the <code>gmultmix</code> function, which has a slightly different set of arguments. Rather than a single formula, the function takes 3 formulas for abundance covariates, availability covariates, and detection covariates in that order.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gmultmix.html">gmultmix</a></span><span class="op">(</span><span class="op">~</span><span class="va">woody</span>, <span class="op">~</span><span class="fl">1</span>, <span class="op">~</span><span class="va">time</span><span class="op">+</span><span class="va">date</span>, <span class="va">umf.cr</span>, engine<span class="op">=</span><span class="st">"R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: K was not specified and was set to 103.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## gmultmix(lambdaformula = ~woody, phiformula = ~1, pformula = ~time + </span></span>
<span><span class="co">##     date, data = umf.cr, engine = "R")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Abundance:</span></span>
<span><span class="co">##             Estimate    SE      z P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)  -0.0896 0.393 -0.228 0.81953</span></span>
<span><span class="co">## woody         2.4294 0.591  4.107 0.00004</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Availability:</span></span>
<span><span class="co">##  Estimate    SE     z P(&gt;|z|)</span></span>
<span><span class="co">##    -0.782 0.495 -1.58   0.114</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection:</span></span>
<span><span class="co">##             Estimate     SE      z  P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)   2.1050 1.1139  1.890 0.058792</span></span>
<span><span class="co">## time         -0.0499 0.0142 -3.526 0.000422</span></span>
<span><span class="co">## date         -0.0285 0.1369 -0.208 0.835258</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC: 580.4508</span></span></code></pre>
<p>Results from this model are similar to those obtained using the subset of data, but the standard error for the woody estimate has decreased. If we back-transform the estimate of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>, we see that the probability of being available for detection is 0.31.</p>
<p>Another feature of <code>gmultmix</code> is that <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math> can be modeled using either the Poisson or negative binomial distribution. We might eventually add other options such as the zero-inflated Poisson.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references hanging-indent">
<div id="ref-alldredge_etal:2007">
<p>Alldredge, M. W., K. H. Pollock, T. R. Simons, J. A. Collazo, S. A. Shriner, and D. Johnson. 2007. Time-of-detection method for estimating abundance from point-count surveys. The Auk 124:653–664.</p>
</div>
<div id="ref-chandler_etal:2009">
<p>Chandler, R. B., D. I. King, and S. DeStefano. 2009. Scrub-shrub bird habitat associations at multiple spatial scales in beaver meadows in massachusetts. The Auk:186–197.</p>
</div>
<div id="ref-chandlerEA_2011">
<p>Chandler, R. B., J. A. Royle, and D. I. King. 2011. Inference about density and temporary emigration in unmarked populations. Ecology 92:1429–1435.</p>
</div>
<div id="ref-dorazio_etal:2005">
<p>Dorazio, R. M., H. L. Jelks, and F. Jordan. 2005. Improving removal-based estimates of abundance by sampling a population of spatially distinct subpopulations. Biometrics 61:1093–1101.</p>
</div>
<div id="ref-efford:2004">
<p>Efford, M. 2004. Density estimation in live-trapping studies. Oikos 106:598–610.</p>
</div>
<div id="ref-kendall_etal:1997">
<p>Kendall, W. L., J. D. Nichols, and J. E. Hines. 1997. Estimating temporary emigration using capture-recapture data with Pollock’s robust design. Ecology 78:563–578.</p>
</div>
<div id="ref-link:2003">
<p>Link, W. A. 2003. Nonidentifiability of population size from capture-recapture data with heterogeneous detection probabilities. Biometrics 59:1123–1130.</p>
</div>
<div id="ref-otis_etal:1978">
<p>Otis, D. L., K. P. Burnham, G. C. White, and D. R. Anderson. 1978. Statistical inference from capture data on closed animal populations. Wildlife monographs:3–135.</p>
</div>
<div id="ref-royle_generalized_2004">
<p>Royle, J. A. 2004. Generalized estimators of avian abundance from count survey data. Animal Biodiversity and Conservation 27:375–386.</p>
</div>
<div id="ref-royle_dorazio:2008">
<p>Royle, J. A., and R. M. Dorazio. 2008. Hierarchical modeling and inference in ecology: The analysis of data from populations, metapopulations and communities. Academic Press.</p>
</div>
<div id="ref-royle_young:2008">
<p>Royle, J. A., and K. V. Young. 2008. A Hierarchical Model For Spatial Capture-Recapture Data. Ecology 89:2281–2289.</p>
</div>
<div id="ref-williams_etal:2002">
<p>Williams, B. K., J. D. Nichols, and M. J. Conroy. 2002. Analysis and management of animal populations: modeling, estimation, and decision making. Academic Pr.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://chandlerlab.uga.edu/richard-chandler-phd/" class="external-link">Richard Chandler</a>, <a href="https://kenkellner.com" class="external-link">Ken Kellner</a>, Ian Fiske, David Miller, Andy Royle, Jeff Hostetler, Rebecca Hutchinson, Adam Smith, Lea Pautrel.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
