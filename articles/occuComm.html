<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Community occupancy models with occuComm • unmarked</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Community occupancy models with occuComm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unmarked</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/unmarked.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cap-recap.html">Modeling variation in abundance using capture-recapture data</a>
    </li>
    <li>
      <a href="../articles/colext.html">Dynamic occupancy models in unmarked</a>
    </li>
    <li>
      <a href="../articles/contributing_to_unmarked.html">Contributing to unmarked: guide to adding a new model to `unmarked`</a>
    </li>
    <li>
      <a href="../articles/distsamp.html">Distance sampling analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/occuComm.html">Community occupancy models with occuComm</a>
    </li>
    <li>
      <a href="../articles/occuMulti.html">Multispecies occupancy models with occuMulti</a>
    </li>
    <li>
      <a href="../articles/powerAnalysis.html">Power Analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/simulate.html">Simulating datasets</a>
    </li>
    <li>
      <a href="../articles/spp-dist.html">Modeling and mapping species distributions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/biodiverse/unmarked/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Community occupancy models with occuComm</h1>
                        <h4 data-toc-skip class="author">Ken
Kellner</h4>
            
            <h4 data-toc-skip class="date">October 25, 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/biodiverse/unmarked/blob/HEAD/vignettes/occuComm.Rmd" class="external-link"><code>vignettes/occuComm.Rmd</code></a></small>
      <div class="hidden name"><code>occuComm.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In a community occupancy model, detection-nondetection data from
multiple species are analyzed together. Intercepts and slopes in the
model are species-specific and come from common distributions, allowing
for information sharing across species. This structure also allows
estimation of site richness. For example, suppose you have sites indexed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
occasions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
and species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>.
The true occupancy state at a site is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>z</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><mo>∼</mo><mrow><mi mathvariant="normal">B</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">i</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ψ</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z_{is} \sim \mathrm{Bernoulli}(\psi_{is})</annotation></semantics></math></p>
<p>with detection data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">y_{ijs}</annotation></semantics></math>
modeled as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi><mi>s</mi></mrow></msub><mo>∼</mo><mrow><mi mathvariant="normal">B</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">i</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mrow><mi>i</mi><mi>j</mi><mi>s</mi></mrow></msub><mo>⋅</mo><msub><mi>z</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_{ijs} \sim \mathrm{Bernoulli}(p_{ijs} \cdot z_{is}) </annotation></semantics></math></p>
<p>Occupancy probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ψ</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">\psi_{is}</annotation></semantics></math>
can be modeled as a function of covariates with species-specific random
intercepts and slopes coming from common distributions:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ψ</mi><mrow><mi>i</mi><mi>s</mi></mrow></msub><mo>=</mo><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mrow><mn>0</mn><mo>,</mo><mi>s</mi></mrow></msub><mo>+</mo><msub><mi>β</mi><mrow><mi>i</mi><mo>,</mo><mi>s</mi></mrow></msub><mo>⋅</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\psi_{is} = \mathrm{logit}(\beta_{0,s} + \beta_{i,s} \cdot x_i) </annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mrow><mn>0</mn><mo>,</mo><mi>s</mi></mrow></msub><mo>∼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><msub><mi>β</mi><mn>0</mn></msub></msub><mo>,</mo><msub><mi>σ</mi><msub><mi>β</mi><mn>0</mn></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> \beta_{0,s} \sim \mathrm{Normal}(\mu_{\beta_0}, \sigma_{\beta_0}) </annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mrow><mn>1</mn><mo>,</mo><mi>s</mi></mrow></msub><mo>∼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><msub><mi>β</mi><mn>1</mn></msub></msub><mo>,</mo><msub><mi>σ</mi><msub><mi>β</mi><mn>1</mn></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> \beta_{1,s} \sim \mathrm{Normal}(\mu_{\beta_1}, \sigma_{\beta_1}) </annotation></semantics></math></p>
<p>A similar structure can be implemented for detection probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>.</p>
<p>Note there is a variety of this model that incorporates hypothetical
completely unobserved species using data augmentation, but that is not a
model that <code>unmarked</code> is able to fit at this time.</p>
</div>
<div class="section level2">
<h2 id="example-dataset">Example dataset<a class="anchor" aria-label="anchor" href="#example-dataset"></a>
</h2>
<p>We’ll use an avian point count dataset from the Swiss breeding bird
survey (MHB) in 2014. The data are counts of 158 species at 267 sites.
The dataset is included in the <code>AHMbook</code> package. For more
detailed analyses of this dataset, see <a href="https://www.sciencedirect.com/book/9780128013786/applied-hierarchical-modeling-in-ecology" class="external-link">Applied
Hiearchical Modeling in Ecology</a>, Volume 1, section 11.6. You can
also check <code><a href="https://rdrr.io/pkg/AHMbook/man/data_MHB2014.html" class="external-link">?MHB2014</a></code> for more information.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.mbr-pwrc.usgs.gov/pubanalysis/keryroylebook/" class="external-link">AHMbook</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">MHB2014</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">MHB2014</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "species" "sites"   "counts"  "date"    "dur"</span></span></code></pre>
<p>Included in this dataset:</p>
<ol style="list-style-type: decimal">
<li>
<code>species</code>: Species-level information and covariates</li>
<li>
<code>sites</code>: Site covariates</li>
<li>
<code>counts</code>: Counts by site and species</li>
<li>
<code>date</code>: Sampling dates (site by occasion)</li>
<li>
<code>dur</code>: Sampling duration (site by occasion)</li>
</ol>
</div>
<div class="section level2">
<h2 id="organize-the-dataset">Organize the dataset<a class="anchor" aria-label="anchor" href="#organize-the-dataset"></a>
</h2>
<div class="section level3">
<h3 id="detection-nondetection-data">Detection-nondetection data<a class="anchor" aria-label="anchor" href="#detection-nondetection-data"></a>
</h3>
<p>We’ll start by converting the count data to detection-nondetection
data (<code>y</code>). The counts are provided in an array format. For
use with <code>occuComm</code>, the <code>y</code> array should have
dimensions site (M) x occasion (J) x species (S). You can also specify
<code>y</code> as a list with length equal to S, with each list element
a matrix with dimensions M x J (similar to <code>occuMulti</code>).
We’ll keep things as an array.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">MHB2014</span><span class="op">$</span><span class="va">counts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 267   3 158</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span><span class="op">[</span><span class="va">y</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="species-covariates">Species covariates<a class="anchor" aria-label="anchor" href="#species-covariates"></a>
</h3>
<p>The model allows for species-level covariates. The covariates must be
provided as a named list. Each list element is a separate covariate and
can have one of three dimensions: either a vector of length S, a matrix
M x S, or an array M x J x S depending on how the covariate varies. For
example, you could provide the mean body weight of the species as a
vector of length S, or the density of the preferred prey of the species
at each site (which could differ by species) as a matrix M x S. In the
MHB data, all the species covariates are body size measurements and thus
are vectors of length S.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spcov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">MHB2014</span><span class="op">$</span><span class="va">species</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"body.length"</span>, <span class="st">"body.mass"</span>, <span class="st">"wing.span"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">spcov</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 3</span></span>
<span><span class="co">##  $ body.length: int [1:158] 27 48 90 35 102 150 80 58 62 55 ...</span></span>
<span><span class="co">##  $ body.mass  : int [1:158] 150 1000 1800 150 3250 11000 3300 1100 1300 1350 ...</span></span>
<span><span class="co">##  $ wing.span  : int [1:158] 43 87 165 55 200 220 165 89 91 130 ...</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="site-covariates">Site covariates<a class="anchor" aria-label="anchor" href="#site-covariates"></a>
</h3>
<p>These are organized as usual for <code>unmarked</code> models and are
contained in <code>MHB2014$sites</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sitecov</span> <span class="op">&lt;-</span> <span class="va">MHB2014</span><span class="op">$</span><span class="va">site</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"elev"</span>, <span class="st">"rlength"</span>, <span class="st">"forest"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sitecov</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   elev rlength forest</span></span>
<span><span class="co">## 1  450     6.4      3</span></span>
<span><span class="co">## 2  450     5.5     21</span></span>
<span><span class="co">## 3 1050     4.3     32</span></span>
<span><span class="co">## 4  950     4.5      9</span></span>
<span><span class="co">## 5 1150     5.4     35</span></span>
<span><span class="co">## 6  550     3.6      2</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="observation-covariates">Observation covariates<a class="anchor" aria-label="anchor" href="#observation-covariates"></a>
</h3>
<p>Again these are organized as usual for <code>unmarked</code> (as a
named list).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obscov</span> <span class="op">&lt;-</span> <span class="va">MHB2014</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"dur"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">obscov</span>, <span class="va">head</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $date</span></span>
<span><span class="co">##      date141 date142 date143</span></span>
<span><span class="co">## Q001      21      52      70</span></span>
<span><span class="co">## Q002      26      47      59</span></span>
<span><span class="co">## Q003      25      52      73</span></span>
<span><span class="co">## Q004      40      55      65</span></span>
<span><span class="co">## Q005      16      38      62</span></span>
<span><span class="co">## Q006      52      61      69</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $dur</span></span>
<span><span class="co">##      dur141 dur142 dur143</span></span>
<span><span class="co">## Q001    215    220    240</span></span>
<span><span class="co">## Q002    195    175    185</span></span>
<span><span class="co">## Q003    210    270    210</span></span>
<span><span class="co">## Q004    310    300    285</span></span>
<span><span class="co">## Q005    240    240    210</span></span>
<span><span class="co">## Q006    180    145    140</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="create-unmarkedframe">Create <code>unmarkedFrame</code><a class="anchor" aria-label="anchor" href="#create-unmarkedframe"></a>
</h3>
<p>The <code>unmarkedFrame</code> type for this model is called
<code>unmarkedFrameOccuComm</code>. Note the <code>speciesCovs</code>
argument which is unique to this <code>unmarkedFrame</code> type.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://groups.google.com/d/forum/unmarked" class="external-link">unmarked</a></span><span class="op">)</span></span>
<span><span class="va">umf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFrameOccuComm.html">unmarkedFrameOccuComm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, siteCovs <span class="op">=</span> <span class="va">sitecov</span>,</span>
<span>                             obsCovs <span class="op">=</span> <span class="va">obscov</span>, speciesCovs <span class="op">=</span> <span class="va">spcov</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">umf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Data frame representation of unmarkedFrame object.</span></span>
<span><span class="co">## Only showing observation matrix for species 1.</span></span>
<span><span class="co">##      y.1 y.2 y.3 elev rlength forest date.1 date.2 date.3 dur.1 dur.2 dur.3</span></span>
<span><span class="co">## Q001   0   0   0  450     6.4      3     21     52     70   215   220   240</span></span>
<span><span class="co">## Q002   0   0   0  450     5.5     21     26     47     59   195   175   185</span></span>
<span><span class="co">## Q003   0   0   0 1050     4.3     32     25     52     73   210   270   210</span></span>
<span><span class="co">## Q004   0   0   0  950     4.5      9     40     55     65   310   300   285</span></span>
<span><span class="co">## Q005   0   0   0 1150     5.4     35     16     38     62   240   240   210</span></span>
<span><span class="co">## Q006   0   0   0  550     3.6      2     52     61     69   180   145   140</span></span>
<span><span class="co">## Q007   0   0   0  750     3.9      6     18     40     60   180   195   180</span></span>
<span><span class="co">## Q008   0   0   0  650     6.1     60     17     39     61   195   225   210</span></span>
<span><span class="co">## Q009   0   0   0  550     5.8      5     18     45     59   190   180   205</span></span>
<span><span class="co">## Q010   0   0   0  550     4.5     13     25     50     76   195   203   215</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="fit-a-model">Fit a model<a class="anchor" aria-label="anchor" href="#fit-a-model"></a>
</h2>
<p>With the dataset organized we can now fit a model with
<code>occuComm</code>. We’ll specify a model with an effect of elevation
(site-level) and body mass (species-level) on occupancy, and no
covariates on detection. The <code>occuComm</code> function
automatically sets up the species-level random effects for intercepts
and slopes. Note however that there will be no random slope by species
for species-level covariates of length S (as this would not make sense).
We can specify the model formulas exactly the same as with the
single-species <code>occu</code> function. This model takes a while to
fit given the large number of species.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occuComm.html">occuComm</a></span><span class="op">(</span><span class="op">~</span><span class="fl">1</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">elev</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">body.mass</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="va">umf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: 158 sites have been discarded because of missing data.</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## occuComm(formula = ~1 ~ scale(elev) + scale(body.mass), data = umf)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Occupancy (logit-scale):</span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##   Groups        Name Variance Std.Dev.</span></span>
<span><span class="co">##  species (Intercept)    9.245    3.041</span></span>
<span><span class="co">##  species scale(elev)    3.169    1.780</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##                  Estimate    SE      z  P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)        -2.980 0.258 -11.57 5.61e-31</span></span>
<span><span class="co">## scale(elev)        -0.717 0.155  -4.63 3.64e-06</span></span>
<span><span class="co">## scale(body.mass)   -0.769 0.272  -2.83 4.72e-03</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection (logit-scale):</span></span>
<span><span class="co">## Random effects:</span></span>
<span><span class="co">##   Groups        Name Variance Std.Dev.</span></span>
<span><span class="co">##  species (Intercept)    1.663    1.289</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fixed effects:</span></span>
<span><span class="co">##  Estimate    SE    z  P(&gt;|z|)</span></span>
<span><span class="co">##     0.633 0.122 5.19 2.15e-07</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC: 46368.93 </span></span>
<span><span class="co">## Number of species: 158</span></span>
<span><span class="co">## Number of sites: 266</span></span>
<span><span class="co">## ID of sites removed due to NA: 30</span></span></code></pre>
<p>We get estimates of the overall (mean) intercepts and slopes. We also
get estimates of the random effects SDs for the intercepts and for the
elevation slopes (but not for body mass, as noted above).</p>
<p>There is some missing data in the model which generates a warning.
You can ignore the exact number of missing sites reported by the warning
- in fact there is only one missing site (#30) which is reported
correctly in the summary.</p>
<div class="section level3">
<h3 id="estimates-of-random-intercepts-and-slopes">Estimates of random intercepts and slopes<a class="anchor" aria-label="anchor" href="#estimates-of-random-intercepts-and-slopes"></a>
</h3>
<p>We can get estimates of the random intercept and slope terms with
<code>randomTerms</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rand_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/randomTerms.html">randomTerms</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rand_est</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Model  Groups        Name               Level  Estimate       SE     lower</span></span>
<span><span class="co">## 1   psi species (Intercept)        Little Grebe -2.659992 1.106212 -4.828127</span></span>
<span><span class="co">## 2   psi species (Intercept) Great Crested Grebe -2.359038 1.241233 -4.791811</span></span>
<span><span class="co">## 3   psi species (Intercept)          Grey Heron -1.517640 1.168330 -3.807526</span></span>
<span><span class="co">## 4   psi species (Intercept)      Little Bittern -3.668043 1.461535 -6.532599</span></span>
<span><span class="co">## 5   psi species (Intercept)         White Stork -1.106583 1.439474 -3.927901</span></span>
<span><span class="co">## 6   psi species (Intercept)           Mute Swan  2.836215 2.545419 -2.152715</span></span>
<span><span class="co">##         upper</span></span>
<span><span class="co">## 1 -0.49185740</span></span>
<span><span class="co">## 2  0.07373509</span></span>
<span><span class="co">## 3  0.77224458</span></span>
<span><span class="co">## 4 -0.80348815</span></span>
<span><span class="co">## 5  1.71473497</span></span>
<span><span class="co">## 6  7.82514579</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">rand_est</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Model  Groups        Name               Level    Estimate        SE</span></span>
<span><span class="co">## 469     p species (Intercept)        Corn Bunting -1.04598590 1.0409023</span></span>
<span><span class="co">## 470     p species (Intercept)        Yellowhammer  1.49688629 0.2277654</span></span>
<span><span class="co">## 471     p species (Intercept)        Cirl Bunting -0.71401947 0.5916209</span></span>
<span><span class="co">## 472     p species (Intercept)     Ortolan Bunting -0.07100565 1.3653792</span></span>
<span><span class="co">## 473     p species (Intercept)        Rock Bunting  0.40225149 0.2812063</span></span>
<span><span class="co">## 474     p species (Intercept) Common Reed Bunting -0.44832431 0.6252049</span></span>
<span><span class="co">##          lower     upper</span></span>
<span><span class="co">## 469 -3.0861169 0.9941451</span></span>
<span><span class="co">## 470  1.0504743 1.9432983</span></span>
<span><span class="co">## 471 -1.8735751 0.4455361</span></span>
<span><span class="co">## 472 -2.7470997 2.6050885</span></span>
<span><span class="co">## 473 -0.1489027 0.9534057</span></span>
<span><span class="co">## 474 -1.6737033 0.7770547</span></span></code></pre>
<p>The estimates provided by this function are mean-0 (i.e., they come
from a normal distribution with mean 0). Thus to get the complete
intercept and slope for each species, we need to add the “fixed” part of
the intercept and slope (shown in the <code>Fixed effects</code> section
of the summary, or with <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>) to the random part shown
above. We can do this with an argument:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rand_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/randomTerms.html">randomTerms</a></span><span class="op">(</span><span class="va">fit</span>, addMean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rand_est</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Model  Groups        Name               Level   Estimate       SE     lower</span></span>
<span><span class="co">## 1   psi species (Intercept)        Little Grebe -5.6402732 1.088450 -7.773597</span></span>
<span><span class="co">## 2   psi species (Intercept) Great Crested Grebe -5.3393185 1.226390 -7.742998</span></span>
<span><span class="co">## 3   psi species (Intercept)          Grey Heron -4.4979213 1.147969 -6.747900</span></span>
<span><span class="co">## 4   psi species (Intercept)      Little Bittern -6.6483243 1.452614 -9.495396</span></span>
<span><span class="co">## 5   psi species (Intercept)         White Stork -4.0868639 1.422657 -6.875221</span></span>
<span><span class="co">## 6   psi species (Intercept)           Mute Swan -0.1440654 2.533089 -5.108828</span></span>
<span><span class="co">##       upper</span></span>
<span><span class="co">## 1 -3.506950</span></span>
<span><span class="co">## 2 -2.935639</span></span>
<span><span class="co">## 3 -2.247943</span></span>
<span><span class="co">## 4 -3.801252</span></span>
<span><span class="co">## 5 -1.298507</span></span>
<span><span class="co">## 6  4.820697</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="get-estimates-of-occupancy">Get estimates of occupancy<a class="anchor" aria-label="anchor" href="#get-estimates-of-occupancy"></a>
</h3>
<p>As usual with <code>unmarked</code>, we can use <code>predict</code>.
The <code>predict</code> function will return estimates of occupancy for
each site and species by default.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, type<span class="op">=</span><span class="st">'state'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">pr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">head</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $`Little Grebe`</span></span>
<span><span class="co">##     Predicted          SE       lower      upper</span></span>
<span><span class="co">## 1 0.062629441 0.027968118 0.025591420 0.14527977</span></span>
<span><span class="co">## 2 0.062629441 0.027968118 0.025591420 0.14527977</span></span>
<span><span class="co">## 3 0.006932087 0.006147293 0.001211306 0.03862620</span></span>
<span><span class="co">## 4 0.010069015 0.007592241 0.002280547 0.04330204</span></span>
<span><span class="co">## 5 0.004767739 0.004893379 0.000634300 0.03489633</span></span>
<span><span class="co">## 6 0.043842917 0.018741413 0.018733213 0.09920657</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`Great Crested Grebe`</span></span>
<span><span class="co">##     Predicted          SE        lower      upper</span></span>
<span><span class="co">## 1 0.040469236 0.023611754 0.0126461928 0.12194572</span></span>
<span><span class="co">## 2 0.040469236 0.023611754 0.0126461928 0.12194572</span></span>
<span><span class="co">## 3 0.004956348 0.004995188 0.0006837188 0.03499409</span></span>
<span><span class="co">## 4 0.007061007 0.006133672 0.0012785527 0.03800045</span></span>
<span><span class="co">## 5 0.003476823 0.004020987 0.0003586577 0.03281439</span></span>
<span><span class="co">## 6 0.028694428 0.015960275 0.0095246153 0.08320543</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`Grey Heron`</span></span>
<span><span class="co">##     Predicted          SE        lower      upper</span></span>
<span><span class="co">## 1 0.047915787 0.024412407 0.0173265386 0.12560618</span></span>
<span><span class="co">## 2 0.047915787 0.024412407 0.0173265386 0.12560618</span></span>
<span><span class="co">## 3 0.006356595 0.005769278 0.0010666779 0.03691114</span></span>
<span><span class="co">## 4 0.008941182 0.006947514 0.0019367894 0.04025524</span></span>
<span><span class="co">## 5 0.004515718 0.004725964 0.0005775214 0.03438506</span></span>
<span><span class="co">## 6 0.034456683 0.016614842 0.0132319646 0.08673438</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="plot-covariate-relationships-by-species">Plot covariate relationships by species<a class="anchor" aria-label="anchor" href="#plot-covariate-relationships-by-species"></a>
</h3>
<p>We’ll plot estimated occupancy by elevation for four species: Common
Buzzard, Northern Raven, Eurasian Jay, and European Crested Tit. We also
need to get the corresponding body mass of each species.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Common Buzzard"</span>, <span class="st">"Northern Raven"</span>, <span class="st">"Eurasian Jay"</span>, <span class="st">"European Crested Tit"</span><span class="op">)</span></span>
<span><span class="va">body_mass</span> <span class="op">&lt;-</span> <span class="va">MHB2014</span><span class="op">$</span><span class="va">species</span><span class="op">$</span><span class="va">body.mass</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">body_mass</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">MHB2014</span><span class="op">$</span><span class="va">species</span><span class="op">$</span><span class="va">engname</span></span>
<span><span class="va">body_mass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">body_mass</span><span class="op">[</span><span class="va">sp</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>First create a sequence of elevation values.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elev_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sitecov</span><span class="op">$</span><span class="va">elev</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sitecov</span><span class="op">$</span><span class="va">elev</span><span class="op">)</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>For each species we create a <code>newdata</code> data frame with
elevation and the species name and matching body mass. Then we use
<code>predict</code>, and plot the results.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sp</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>elev<span class="op">=</span><span class="va">elev_seq</span>,</span>
<span>                   species <span class="op">=</span> <span class="va">sp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                   body.mass <span class="op">=</span> <span class="va">body_mass</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">'state'</span>, newdata<span class="op">=</span><span class="va">nd</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">elev_seq</span>, <span class="va">pr</span><span class="op">$</span><span class="va">Predicted</span>, type<span class="op">=</span><span class="st">'l'</span>, xlab<span class="op">=</span><span class="st">"Elevation"</span>, ylab<span class="op">=</span><span class="st">"Occupancy"</span>,</span>
<span>       main <span class="op">=</span> <span class="va">sp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">elev_seq</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">elev_seq</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pr</span><span class="op">$</span><span class="va">lower</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">pr</span><span class="op">$</span><span class="va">upper</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'grey90'</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">elev_seq</span>, <span class="va">pr</span><span class="op">$</span><span class="va">Predicted</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="float">
<img src="occuComm-figures%2FoccuComm-predict-1.png" alt="Predicted occupancy by species"><div class="figcaption">Predicted occupancy by species</div>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="richness">Richness<a class="anchor" aria-label="anchor" href="#richness"></a>
</h3>
<p>There’s a built-in function for calculating richness at each site
from the model.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rich</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/richness.html">richness</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rich</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 33.49 34.93 52.52 42.07 45.55 43.46</span></span></code></pre>
<p>To get the uncertainty of this estimate, we can return a complete
posterior and calculate CIs:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/richness.html">richness</a></span><span class="op">(</span><span class="va">fit</span>, posterior<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post</span><span class="op">@</span><span class="va">samples</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post</span><span class="op">@</span><span class="va">samples</span>, <span class="fl">1</span>, <span class="va">quantile</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span><span class="va">up</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">post</span><span class="op">@</span><span class="va">samples</span>, <span class="fl">1</span>, <span class="va">quantile</span>, <span class="fl">0.975</span><span class="op">)</span></span></code></pre></div>
<p>And compare them to naive richness:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rich_naive</span> <span class="op">&lt;-</span> <span class="va">MHB2014</span><span class="op">$</span><span class="va">counts</span></span>
<span><span class="va">rich_naive</span><span class="op">[</span><span class="va">rich_naive</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">rich_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">rich_naive</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, </span>
<span>                    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span> <span class="kw">else</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">rich_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">rich_naive</span>, <span class="fl">1</span>, <span class="va">sum</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rich_naive</span>, <span class="va">est</span>, xlab<span class="op">=</span><span class="st">"Observed species"</span>, ylab<span class="op">=</span><span class="st">"Estimated richness"</span>, </span>
<span>     pch<span class="op">=</span><span class="fl">19</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span><span class="va">rich_naive</span>, <span class="va">low</span>, <span class="va">rich_naive</span>, <span class="va">up</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="occuComm-figures%2FoccuComm-rich-1.png" alt="Richness by site"><div class="figcaption">Richness by site</div>
</div>
<p>This figure should look similar to Figure 11.8 in the AHM 1 book
(it’s not quite the same model).</p>
</div>
</div>
<div class="section level2">
<h2 id="handling-guilds-or-similar-groups">Handling guilds or similar groups<a class="anchor" aria-label="anchor" href="#handling-guilds-or-similar-groups"></a>
</h2>
<p>In community occupancy models it is common to specify an additional
hierarchical structure above species, e.g. guild. In this version of the
model, rather than the random intercepts and slopes coming from common
distributions across <em>all</em> species, instead information is shared
only among species belonging to the same guild. The model structure is
the same as above except the random effect hyperparameters are
guild-specific where each species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
belongs to one guild
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ψ</mi><mrow><mi>i</mi><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>g</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo>=</mo><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mrow><mn>0</mn><mo>,</mo><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>g</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo>+</mo><msub><mi>β</mi><mrow><mi>i</mi><mo>,</mo><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>g</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo>⋅</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\psi_{is(g)} = \mathrm{logit}(\beta_{0,s(g)} + \beta_{i,s(g)} \cdot x_i) </annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mrow><mn>0</mn><mo>,</mo><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>g</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo>∼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><msub><mi>β</mi><mrow><mn>0</mn><mo>,</mo><mi>g</mi></mrow></msub></msub><mo>,</mo><msub><mi>σ</mi><msub><mi>β</mi><mrow><mn>0</mn><mo>,</mo><mi>g</mi></mrow></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> \beta_{0,s(g)} \sim \mathrm{Normal}(\mu_{\beta_{0,g}}, \sigma_{\beta_{0,g}}) </annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mrow><mn>1</mn><mo>,</mo><mi>s</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>g</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo>∼</mo><mrow><mi mathvariant="normal">N</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><msub><mi>β</mi><mrow><mn>1</mn><mo>,</mo><mi>g</mi></mrow></msub></msub><mo>,</mo><msub><mi>σ</mi><msub><mi>β</mi><mrow><mn>1</mn><mo>,</mo><mi>g</mi></mrow></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex"> \beta_{1,s(g)} \sim \mathrm{Normal}(\mu_{\beta_{1,g}}, \sigma_{\beta_{1,g}}) </annotation></semantics></math></p>
<p>For example, see the analysis in section 11.6.3 of AHM 1.</p>
<p>The <code>occuComm</code> function cannot directly handle this extra
hierarchical layer as you can in say, JAGS or NIMBLE. However, we can
get pretty close. Note that often when we fit a guild-based model like
this, we are in effect fitting entirely separate models for each guild.
That is, since no information is being shared among guilds (only within
them) we can simply separate the data by guild and fit separate models
to each piece and get the same result. We can then combine the results
to get richness, if needed. This <code>occuComm</code> is able to
do.</p>
<div class="section level3">
<h3 id="dividing-the-data-by-guild">Dividing the data by guild<a class="anchor" aria-label="anchor" href="#dividing-the-data-by-guild"></a>
</h3>
<p>We’ll divide the species into three “guilds” based on body mass. This
code is identical to the code in AHM 1, section 11.6.3.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Look at distribution of body mass among 136 observed species</span></span>
<span><span class="co"># Get mean species mass</span></span>
<span><span class="va">mass</span> <span class="op">&lt;-</span> <span class="va">MHB2014</span><span class="op">$</span><span class="va">species</span><span class="op">$</span><span class="va">body.mass</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">40</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="occuComm-figures%2FoccuComm-hist-1.png" alt="Distribution of log10(body mass)"><div class="figcaption">Distribution of log10(body mass)</div>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Look at log10</span></span>
<span><span class="va">gmass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">1.3</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Size groups 1, 2 and 3</span></span>
<span><span class="va">gmass</span><span class="op">[</span><span class="va">gmass</span> <span class="op">==</span> <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># Mute swan is group 3, too</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-separate-models-by-guild">Fit separate models by guild<a class="anchor" aria-label="anchor" href="#fit-separate-models-by-guild"></a>
</h3>
<p>Now we simply divide our complete dataset into pieces by guild and
fit the same model to each dataset separately.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Guild 1</span></span>
<span><span class="va">spcovs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">spcov</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">gmass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">umf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFrameOccuComm.html">unmarkedFrameOccuComm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">umf</span><span class="op">@</span><span class="va">ylist</span><span class="op">[</span><span class="va">gmass</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>,</span>
<span>                              siteCovs <span class="op">=</span> <span class="va">sitecov</span>,</span>
<span>                              obsCovs <span class="op">=</span> <span class="va">obscov</span>,</span>
<span>                              speciesCovs <span class="op">=</span> <span class="va">spcovs1</span><span class="op">)</span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">umf1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: 45 sites have been discarded because of missing data.</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Guild 2</span></span>
<span><span class="va">spcovs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">spcov</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">gmass</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">umf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFrameOccuComm.html">unmarkedFrameOccuComm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">umf</span><span class="op">@</span><span class="va">ylist</span><span class="op">[</span><span class="va">gmass</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span>,</span>
<span>                              siteCovs <span class="op">=</span> <span class="va">sitecov</span>,</span>
<span>                              obsCovs <span class="op">=</span> <span class="va">obscov</span>,</span>
<span>                              speciesCovs <span class="op">=</span> <span class="va">spcovs2</span><span class="op">)</span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">umf2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: 86 sites have been discarded because of missing data.</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Guild 3</span></span>
<span><span class="va">spcovs3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">spcov</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">gmass</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">umf3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFrameOccuComm.html">unmarkedFrameOccuComm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">umf</span><span class="op">@</span><span class="va">ylist</span><span class="op">[</span><span class="va">gmass</span> <span class="op">==</span> <span class="fl">3</span><span class="op">]</span>,</span>
<span>                              siteCovs <span class="op">=</span> <span class="va">sitecov</span>,</span>
<span>                              obsCovs <span class="op">=</span> <span class="va">obscov</span>,</span>
<span>                              speciesCovs <span class="op">=</span> <span class="va">spcovs3</span><span class="op">)</span></span>
<span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">umf3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: 27 sites have been discarded because of missing data.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="calculate-richness">Calculate richness<a class="anchor" aria-label="anchor" href="#calculate-richness"></a>
</h3>
<p>To get richness across the entire community, we get posterior samples
of richness for each guild and combine them.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/richness.html">richness</a></span><span class="op">(</span><span class="va">fit1</span>, posterior<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">post2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/richness.html">richness</a></span><span class="op">(</span><span class="va">fit2</span>, posterior<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">post3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/richness.html">richness</a></span><span class="op">(</span><span class="va">fit3</span>, posterior<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rich_all</span> <span class="op">&lt;-</span> <span class="va">post1</span><span class="op">@</span><span class="va">samples</span> <span class="op">+</span> <span class="va">post2</span><span class="op">@</span><span class="va">samples</span> <span class="op">+</span> <span class="va">post3</span><span class="op">@</span><span class="va">samples</span></span>
<span><span class="va">rich_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">rich_all</span><span class="op">)</span></span></code></pre></div>
<p>The result is more or less identical to our previous richness
estimate using a single model.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rich_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">rich_all</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rich</span>, <span class="va">rich_mean</span>, xlab<span class="op">=</span><span class="st">"Combined model"</span>, ylab<span class="op">=</span><span class="st">"Guilds model"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="occuComm-figures%2FoccuComm-comp-1.png" alt="Richness estimate comparison"><div class="figcaption">Richness estimate comparison</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://chandlerlab.uga.edu/richard-chandler-phd/" class="external-link">Richard Chandler</a>, <a href="https://kenkellner.com" class="external-link">Ken Kellner</a>, Ian Fiske, David Miller, Andy Royle, Jeff Hostetler, Rebecca Hutchinson, Adam Smith, Lea Pautrel.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
