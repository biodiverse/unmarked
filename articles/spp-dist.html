<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modeling and mapping species distributions • unmarked</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Modeling and mapping species distributions">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unmarked</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.1.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/unmarked.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cap-recap.html">Modeling variation in abundance using capture-recapture data</a>
    </li>
    <li>
      <a href="../articles/colext.html">Dynamic occupancy models in unmarked</a>
    </li>
    <li>
      <a href="../articles/contributing_to_unmarked.html">Contributing to unmarked: guide to adding a new model to `unmarked`</a>
    </li>
    <li>
      <a href="../articles/distsamp.html">Distance sampling analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/occuMulti.html">Multispecies occupancy models with occuMulti</a>
    </li>
    <li>
      <a href="../articles/powerAnalysis.html">Power Analysis in unmarked</a>
    </li>
    <li>
      <a href="../articles/simulate.html">Simulating datasets</a>
    </li>
    <li>
      <a href="../articles/spp-dist.html">Modeling and mapping species distributions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rbchan/unmarked/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="spp-dist_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Modeling and mapping species distributions</h1>
                        <h4 data-toc-skip class="author">Richard Chandler</h4>
            
            <h4 data-toc-skip class="date">Feb 5, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rbchan/unmarked/blob/HEAD/vignettes/spp-dist.Rmd" class="external-link"><code>vignettes/spp-dist.Rmd</code></a></small>
      <div class="hidden name"><code>spp-dist.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h2>
<p>A species’ distribution can be characterized by either occurrence probability or population density, defined for all locations in some spatial extent. Defining distribution in terms of these two parameters %These definitions of species distribution avoids the ambiguity surrounding the indices of occurrence or abundance produced by many presence-only algorithms. The <code>unmarked</code> package contains methods of fitting occurrence and abundance models, and can be used to produce distribution maps with the help of <code>R</code>’s GIS capabilities, as is demonstrated in this vignette. Unlike many other tools for modeling species distributions, the models in <code>unmarked</code> account for bias due to spatial and temporal heterogeneity in detection probability. Furthermore, <code>unmarked</code> includes models of population dynamics, allowing one to map quantities such as local colonization or extinction probability.</p>
</div>
<div class="section level2">
<h2 id="mapping-occurrence-probability">Mapping Occurrence Probability<a class="anchor" aria-label="anchor" href="#mapping-occurrence-probability"></a>
</h2>
<p>In this example, we use the <code>occu</code> function to fit the single-season occupancy model of <span class="citation">MacKenzie et al. (2002)</span> to data on the European crossbill (<em>Loxia curvirostra</em>) collected in 267 1-km<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>2</mn></msup><annotation encoding="application/x-tex">^2</annotation></semantics></math> sample quadrats in Switzerland, 1999 <span class="citation">(Schmid et al. 2004)</span>. We then use the model to compute the expected probability of occurrence at each pixel in a raster defining the Swiss landscape.</p>
<p>First we load the <code>crossbill</code> data, which contains the detection/non-detection data and covariates. The dataset actually contains data from multiple years, but we are only going to analyze data from the first year, 1999. A multi-year analysis of occupancy dynamics could be accomplished using the <code>colext</code> function, and in addition to mapping occurrence probability, it would be possible to also map colonization and extinction probabilities. The following commands format the data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://groups.google.com/d/forum/unmarked" class="external-link">unmarked</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">crossbill</span><span class="op">)</span></span>
<span><span class="va">umf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFrameOccu.html">unmarkedFrameOccu</a></span><span class="op">(</span></span>
<span>    y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">crossbill</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"det991"</span>, <span class="st">"det992"</span>, <span class="st">"det993"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    siteCovs<span class="op">=</span><span class="va">crossbill</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ele"</span>, <span class="st">"forest"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    obsCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>date<span class="op">=</span><span class="va">crossbill</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date991"</span>, <span class="st">"date992"</span>, <span class="st">"date993"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="../reference/unmarkedFrame-class.html">siteCovs</a></span><span class="op">(</span><span class="va">umf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/unmarkedFrame-class.html">siteCovs</a></span><span class="op">(</span><span class="va">umf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sc</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">umf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Data frame representation of unmarkedFrame object.</span></span>
<span><span class="co">##    y.1 y.2 y.3         ele      forest date.1 date.2 date.3</span></span>
<span><span class="co">## 1    0   0   0 -1.15390803 -1.14710440     34     59     65</span></span>
<span><span class="co">## 2    0   0   0 -1.15390803 -0.49668159     17     33     65</span></span>
<span><span class="co">## 3   NA  NA  NA -0.21745379 -0.09920098     NA     NA     NA</span></span>
<span><span class="co">## 4    0   0   0 -0.37352950 -0.93029679     29     59     65</span></span>
<span><span class="co">## 5    0   0   0 -0.06137809  0.00920282     24     45     65</span></span>
<span><span class="co">## 6   NA  NA  NA -0.99783232 -1.18323900     NA     NA     NA</span></span>
<span><span class="co">## 7    0   0   0 -0.68568091 -1.03870060     26     54     74</span></span>
<span><span class="co">## 8    0   0   0 -0.84175662  0.91256783     23     43     71</span></span>
<span><span class="co">## 9    0   0   0 -0.99783232 -1.07483520     21     36     56</span></span>
<span><span class="co">## 10   0   0   0 -0.99783232 -0.78575839     37     62     75</span></span></code></pre>
<p>Notice that the site covariates, elevation and forest, were standardized using the <code>scale</code> function. Standardization isn’t always necessary, but it can make it easier to find the maximum likelihood estimates. When standardizing covariates and then making predictions, it is important to retain the original sample mean and standard deviation. The reason for this is explained below.</p>
<p>Fitting a model is now straight-forward. In many cases, we would fit several models corresponding to competing hypotheses, but for simplicity, we stick with this single model.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">fm.occu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/occu.html">occu</a></span><span class="op">(</span><span class="op">~</span><span class="va">date</span> <span class="op">~</span><span class="va">ele</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">ele</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">forest</span>, <span class="va">umf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: 22 sites have been discarded because of missing data.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## occu(formula = ~date ~ ele + I(ele^2) + forest, data = umf)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Occupancy:</span></span>
<span><span class="co">##             Estimate    SE      z P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)    0.464 0.541  0.857 0.39137</span></span>
<span><span class="co">## ele            1.228 0.319  3.846 0.00012</span></span>
<span><span class="co">## I(ele^2)      -1.333 0.417 -3.194 0.00140</span></span>
<span><span class="co">## forest         0.654 0.274  2.385 0.01706</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection:</span></span>
<span><span class="co">##             Estimate      SE     z  P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)  -2.2356 0.52283 -4.28 0.000019</span></span>
<span><span class="co">## date          0.0254 0.00752  3.39 0.000711</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC: 455.3892</span></span></code></pre>
<p>Now that we have our fitted model, we can use it to predict occurrence probability at each pixel in the Swiss landscape. The <code>Switzerland</code> dataset contains country-wide data. There are many ways to display it—here is an example of mapping elevation using the <code>levelplot</code> function in the <code>lattice</code> package <span class="citation">(Sarkar 2008)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lattice.r-forge.r-project.org/" class="external-link">lattice</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Switzerland</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/levelplot.html" class="external-link">levelplot</a></span><span class="op">(</span><span class="va">elevation</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span>, <span class="va">Switzerland</span>, aspect<span class="op">=</span><span class="st">"iso"</span>,</span>
<span>                xlab<span class="op">=</span><span class="st">"Easting (m)"</span>, ylab<span class="op">=</span><span class="st">"Northing (m)"</span>,</span>
<span>                col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="spp-dist_files/figure-html/unnamed-chunk-5-1.png" alt="Figure 1. Elevation in Switzerland" width="480"><p class="caption">
Figure 1. Elevation in Switzerland
</p>
</div>
<p>The <code>raster</code> package <span class="citation">(Jacob van Etten 2012)</span> provides another alternative. Here we create two raster objects and specify the coordinate system.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elevation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html" class="external-link">rasterFromXYZ</a></span><span class="op">(</span><span class="va">Switzerland</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"elevation"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs<span class="op">=</span><span class="st">"+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html" class="external-link">rasterFromXYZ</a></span><span class="op">(</span><span class="va">Switzerland</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"forest"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    crs<span class="op">=</span><span class="st">"+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs"</span><span class="op">)</span></span></code></pre></div>
<p>Since we standardized the covariates during the model fitting process, we need to transform the country-wide data using the same values. Note, we don’t want to use the mean and SD of the rasters themselves, we want to use the mean and SD of the original covariates used to fit the models, which are stored as attributes of the <code>sc</code> object. The following commands display the original means and SDs and then transform the rasters and join them in a raster “stack”.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">sc</span>, <span class="st">"scaled:center"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        ele     forest </span></span>
<span><span class="co">## 1189.32584   34.74532</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">sc</span>, <span class="st">"scaled:scale"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       ele    forest </span></span>
<span><span class="co">## 640.71471  27.67431</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ele.s</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">elevation</span><span class="op">-</span><span class="fl">1189</span><span class="op">)</span><span class="op">/</span><span class="fl">640</span></span>
<span><span class="va">forest.s</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">forest</span><span class="op">-</span><span class="fl">34.7</span><span class="op">)</span><span class="op">/</span><span class="fl">27.7</span></span>
<span><span class="va">ef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">ele.s</span>, <span class="va">forest.s</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ef</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ele"</span>, <span class="st">"forest"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ef</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="spp-dist_files/figure-html/unnamed-chunk-9-1.png" alt="Figure 2. Elevation and forest cover, standardized" width="576"><p class="caption">
Figure 2. Elevation and forest cover, standardized
</p>
</div>
<p>It is important to assign <code>names</code> that exactly match the covariate names used to fit the model. This is required by the <code>predict</code> function as demonstrated later. The <code>predict</code> function is useful for computing spatially-referenced model predictions, standard errors, and confidence intervals, but it is computationally demanding when there are many pixels in the raster. Thus, if measures of uncertainty are not required, the following code can be used to quickly produce the species distribution map shown in Fig. 3.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fm.occu</span>, type<span class="op">=</span><span class="st">"state"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      psi(Int)      psi(ele) psi(I(ele^2))   psi(forest) </span></span>
<span><span class="co">##     0.4638233     1.2276426    -1.3327186     0.6544976</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logit.psi</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">ele.s</span> <span class="op">+</span> <span class="va">beta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="va">ele.s</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">beta</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">*</span><span class="va">forest.s</span></span>
<span><span class="va">psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logit.psi</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logit.psi</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/spplot.html" class="external-link">spplot</a></span><span class="op">(</span><span class="va">psi</span>, col.regions<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="spp-dist_files/figure-html/unnamed-chunk-10-1.png" alt="Figure 3. A species distribution map for the European crossbill in Switzerland. The colors represent occurrence probability." width="384"><p class="caption">
Figure 3. A species distribution map for the European crossbill in Switzerland. The colors represent occurrence probability.
</p>
</div>
<p>As of version 0.9-6, the <code>predict</code> method in <code>unmarked</code> can make predictions using an object of class <code>RasterStack</code> from the  package. As mentioned previously, the rasters must be named, perhaps by using the <code>names(someraster) &lt;- somename</code> method. The object returned by <code>predict</code> is another raster stack with rasters for the expected values of the parameter of interest, the standard errors, and the upper and lower confidence intervals. The following example is very slow because there are many of pixels in the raster. The resulting map is shown in Fig. 4.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">E.psi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fm.occu</span>, type<span class="op">=</span><span class="st">"state"</span>, newdata<span class="op">=</span><span class="va">ef</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">E.psi</span>, axes<span class="op">=</span><span class="cn">FALSE</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="spp-dist_files/figure-html/unnamed-chunk-11-1.png" alt="Figure 4. Expected occurrence probability along with standard errors and the limits of the asymptotic 95% confidence interval." width="480"><p class="caption">
Figure 4. Expected occurrence probability along with standard errors and the limits of the asymptotic 95% confidence interval.
</p>
</div>
<p>Users should be cautious when predicting from models that have categorical predictor variables, i.e. <code>factor</code>s. The  package does not have advanced methods for handling factors, and thus it is not easy to automatically create dummy variables from them as can typically be done using <code>model.matrix</code>. The safest option is to create the dummy variables manually before fitting the models, and to use the same variables as rasters for prediction.</p>
<p>A more important consideration when creating species distribution maps based upon occurrence probability is that of spatial scale. Occurrence probability will typically depend upon the area of the “site” in question. Thus, in our crossbill example, it would not be appropriate to use our model to predict occurrence probability for 10-km<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>2</mn></msup><annotation encoding="application/x-tex">^2</annotation></semantics></math> pixels since the surveys were done in 1-km<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>2</mn></msup><annotation encoding="application/x-tex">^2</annotation></semantics></math> quadrats. In some cases it might be possible to directly model the effect of site area on occurrence probability, in which case the effect could be accounted for in the predictions.</p>
</div>
<div class="section level2">
<h2 id="mapping-population-density">Mapping Population Density<a class="anchor" aria-label="anchor" href="#mapping-population-density"></a>
</h2>
<p>Although distribution is typically described in terms of occurrence probability, which is always better than an index of occurrence probability, the best parameter for modeling species distribution is population density because density allows for inference about population size in any region of the species’ range. Furthermore, occurrence probability is simply the probability that abundance is greater than 0, so with density/abundance estimates, it is always possible to compute occurrence probability as a derived parameter.</p>
<p>In this example, we create a distribution map for the Island Scrub-Jay (<em>Aphelocoma insularis</em>), which is restricted to Santa Cruz Island, California. To do so, we fit the hierarchical distance sampling model of <span class="citation">Royle et al. (2004)</span>, which allows for the estimation of abundance in each of the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>300</mn><mo>×</mo><mn>300</mn></mrow><annotation encoding="application/x-tex">300 \times 300</annotation></semantics></math>m pixels representing the island. The data were collected 307, 300-m radius point count (or “point transect”) surveyed during the Fall of 2008.</p>
<p>IMPORTANT: This analysis is for demonstration purposes only, and the estimates of population size should not be used for conservation or management purposes. Indeed, the Poisson assumption used here was found to be inadequate by <span class="citation">Sillett et al. (2012)</span> who conducted a rigorous analysis and reported reliable estimate of population size.</p>
<p>Although we are fitting a model of population density, the steps of the analysis closely mirror those shown in the previous section. First, we format the data and fit a model, then we format the island-wide covariates and make predictions. The three covariates thought to influence jay abundance are elevation, forest cover, and chapararral cover. We also include include the area of the survey plots in the analysis so that we can make predictions for regions of any area. Here is the code to format the data and fit the model.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">issj</span><span class="op">)</span></span>
<span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">issj</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"elevation"</span>, <span class="st">"forest"</span>, <span class="st">"chaparral"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">area</span> <span class="op">&lt;-</span> <span class="va">pi</span><span class="op">*</span><span class="fl">300</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fl">10000</span></span>
<span><span class="va">jayumf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unmarkedFrameDS.html">unmarkedFrameDS</a></span><span class="op">(</span>y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">issj</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                          siteCovs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">covs</span>, <span class="va">area</span><span class="op">)</span>,</span>
<span>                          dist.breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>,<span class="fl">200</span>,<span class="fl">300</span><span class="op">)</span>,</span>
<span>                          unitsIn<span class="op">=</span><span class="st">"m"</span>, survey<span class="op">=</span><span class="st">"point"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">jayumf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Data frame representation of unmarkedFrame object.</span></span>
<span><span class="co">##    y.1 y.2 y.3   elevation     forest  chaparral     area</span></span>
<span><span class="co">## 1    0   0   2 -1.20607849 -0.3309618 -0.1218243 28.27433</span></span>
<span><span class="co">## 2    0   0   0 -0.36132054 -0.4429552  0.8384709 28.27433</span></span>
<span><span class="co">## 3    0   0   0 -0.45797193 -0.3738751  2.1319298 28.27433</span></span>
<span><span class="co">## 4    0   0   0 -0.14196112  1.3908065 -0.2737078 28.27433</span></span>
<span><span class="co">## 5    0   0   0 -0.72588125 -0.4869152 -1.1562240 28.27433</span></span>
<span><span class="co">## 6    0   0   0  0.01704522  0.6706992  0.2989173 28.27433</span></span>
<span><span class="co">## 7    0   0   0 -0.11866710 -0.2671150  1.0326122 28.27433</span></span>
<span><span class="co">## 8    0   0   0 -0.76411740 -0.4921486 -0.9332983 28.27433</span></span>
<span><span class="co">## 9    0   0   0  0.40065595  0.5440524 -1.0759952 28.27433</span></span>
<span><span class="co">## 10   0   0   0 -0.24030211 -0.4921486 -1.1023299 28.27433</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distsamp.html">distsamp</a></span><span class="op">(</span><span class="op">~</span><span class="va">chaparral</span> <span class="op">~</span><span class="va">chaparral</span> <span class="op">+</span> <span class="va">elevation</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="va">jayumf</span>, keyfun<span class="op">=</span><span class="st">"halfnorm"</span>, output<span class="op">=</span><span class="st">"abund"</span>,</span>
<span>                starts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.8</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">4.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fm1</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## distsamp(formula = ~chaparral ~ chaparral + elevation + offset(log(area)), </span></span>
<span><span class="co">##     data = jayumf, keyfun = "halfnorm", output = "abund", starts = c(-2.8, </span></span>
<span><span class="co">##         1, 0, 4.5, 0))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Abundance:</span></span>
<span><span class="co">##             Estimate     SE      z  P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)   -2.827 0.1609 -17.57 4.34e-69</span></span>
<span><span class="co">## chaparral      0.957 0.1460   6.55 5.60e-11</span></span>
<span><span class="co">## elevation     -0.244 0.0932  -2.61 8.96e-03</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Detection:</span></span>
<span><span class="co">##             Estimate     SE     z  P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)     4.73 0.0845 55.96 0.000000</span></span>
<span><span class="co">## chaparral      -0.25 0.0744 -3.36 0.000773</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC: 964.6426</span></span></code></pre>
<p>Remarks. 1) The distance data were binned into 3 distance classes. 2) We used <code>output="abund"</code> even though, by specifying the offset, we effectively modeled population density. As stated previously, this allows us to make predictions of abundance for regions of arbitrary size.</p>
<p>The next thing to do is to format the raster data. For details, see the previous section-the process is the same, except that we need a raster for <code>"area"</code>, the size of each pixel in the raster data. This is necessary because the survey plots were larger than the pixels for which we want predictions of abundance.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cruz</span><span class="op">)</span></span>
<span><span class="va">elev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html" class="external-link">rasterFromXYZ</a></span><span class="op">(</span><span class="va">cruz</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"elevation"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>     crs<span class="op">=</span><span class="st">"+proj=utm +zone=11 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"</span><span class="op">)</span></span>
<span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html" class="external-link">rasterFromXYZ</a></span><span class="op">(</span><span class="va">cruz</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"forest"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>     crs<span class="op">=</span><span class="st">"+proj=utm +zone=11 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"</span><span class="op">)</span></span>
<span><span class="va">chap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html" class="external-link">rasterFromXYZ</a></span><span class="op">(</span><span class="va">cruz</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"chaparral"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>     crs<span class="op">=</span><span class="st">"+proj=utm +zone=11 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"</span><span class="op">)</span></span>
<span><span class="va">area.raster</span> <span class="op">&lt;-</span> <span class="va">chap</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">area.raster</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">300</span><span class="op">*</span><span class="fl">300</span><span class="op">/</span><span class="fl">10000</span> <span class="co"># area of a grid pixel</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">covs</span>, <span class="st">"scaled:center"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   elevation      forest   chaparral </span></span>
<span><span class="co">## 202.0023616   0.0673357   0.2703592</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">covs</span>, <span class="st">"scaled:scale"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   elevation      forest   chaparral </span></span>
<span><span class="co">## 124.8818069   0.1368199   0.2338295</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elev.s</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">elev</span><span class="op">-</span><span class="fl">202</span><span class="op">)</span><span class="op">/</span><span class="fl">125</span></span>
<span><span class="va">forest.s</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">forest</span><span class="op">-</span><span class="fl">0.0673</span><span class="op">)</span><span class="op">/</span><span class="fl">0.137</span></span>
<span><span class="va">chap.s</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">chap</span><span class="op">-</span><span class="fl">0.270</span><span class="op">)</span><span class="op">/</span><span class="fl">0.234</span></span>
<span><span class="va">habitat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">elev.s</span>, <span class="va">forest.s</span>, <span class="va">chap.s</span>, <span class="va">area.raster</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">habitat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"elevation"</span>, <span class="st">"forest"</span>, <span class="st">"chaparral"</span>, <span class="st">"area"</span><span class="op">)</span></span></code></pre></div>
<p>Now, when we use <code>predict</code>, it will return the expected number of jays in each pixel along with the standard errors and the 95% confidence intervals. We could sum these up to obtain an estimate of total population size. <span class="citation">Sillett et al. (2012)</span> did this and used the parametric bootstrap to estimate the variance of total population size.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict-methods.html">predict</a></span><span class="op">(</span><span class="va">fm1</span>, type<span class="op">=</span><span class="st">"state"</span>, newdata<span class="op">=</span><span class="va">habitat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">E</span>, axes<span class="op">=</span><span class="cn">FALSE</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="spp-dist_files/figure-html/unnamed-chunk-14-1.png" alt="Figure 5. Expeted Island Scrub-Jay abundance, SEs, and 95% CIs." width="576"><p class="caption">
Figure 5. Expeted Island Scrub-Jay abundance, SEs, and 95% CIs.
</p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references hanging-indent">
<div id="ref-hijmans_vanEtten:2012">
<p>Jacob van Etten, R. J. H. &amp;. 2012. Raster: Geographic analysis and modeling with raster data.</p>
</div>
<div id="ref-mackenzie_estimating_2002">
<p>MacKenzie, D. I., J. D. Nichols, G. B. Lachman, S. Droege, J. A. Royle, and C. A. Langtimm. 2002. Estimating site occupancy rates when detection probabilities are less than one. Ecology 83:2248–2255.</p>
</div>
<div id="ref-royle_modeling_2004">
<p>Royle, J. A., D. K. Dawson, and S. Bates. 2004. Modeling abundance effects in distance sampling. Ecology 85:1591–1597.</p>
</div>
<div id="ref-sarkar:2008">
<p>Sarkar, D. 2008. Lattice: Multivariate data visualization with r. Springer, New York.</p>
</div>
<div id="ref-schmid_etal:2004">
<p>Schmid, H., N. Zbinden, and V. Keller. 2004. Überwachung der bestandsentwicklung häufiger brutvögel in der schweiz. Swiss Ornithological Institute Sempach Switzerland.</p>
</div>
<div id="ref-sillett_etal:2012">
<p>Sillett, S., R. B. Chandler, J. A. Royle, M. Kéry, and S. A. Morrison. 2012. Hierarchical distance sampling models to estimate population size and habitat-specific abundance of an island endemic. Ecological Applications 22:1997–2006.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://chandlerlab.uga.edu/richard-chandler-phd/" class="external-link">Richard Chandler</a>, <a href="https://kenkellner.com" class="external-link">Ken Kellner</a>, Ian Fiske, David Miller, Andy Royle, Jeff Hostetler, Rebecca Hutchinson, Adam Smith, Lea Pautrel.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
